<UserControl
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:cal="http://www.caliburnproject.org"
        xmlns:Syncfusion="http://schemas.syncfusion.com/wpf" x:Class="IposV3.Views.PuntoVentaView"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
        xmlns:cbind="clr-namespace:CalcBinding;assembly=CalcBinding"
        xmlns:local="clr-namespace:IposV3"
            xmlns:localCommon="clr-namespace:UICommon;assembly=UICommon"
        xmlns:localViews="clr-namespace:IposV3.Views"
        xmlns:localCont="clr-namespace:Controls;assembly=UICommon"
        xmlns:localConv="clr-namespace:Converters;assembly=UICommon"
        xmlns:ac="clr-namespace:AdornedControl;assembly=AdornedControl"
        xmlns:SfExt="clr-namespace:SyncfusionExt;assembly=UICommon"
        cal:Message.Attach="[Event Loaded]=[Action ViewLoaded($eventArgs)]"
        mc:Ignorable="d"
        VerticalAlignment="Stretch"
        Width="{Binding Source={x:Static SystemParameters.PrimaryScreenWidth}, Converter={localConv:WindowSizeConverter}, ConverterParameter='0.98'}"
        >
    <UserControl.Resources>
        <SolidColorBrush x:Key="IconBrush" Color="DodgerBlue"/>
        <localConv:PackIconImageSourceConverter x:Key="PackIconImageSourceConverter" />
        <localConv:StringFormatConverter x:Key="StringFormatConverter" />

        <localConv:HexColorConverter x:Key="hexcolorconverter"/>
        <localConv:HexTextColorConverter x:Key="hexTextcolorconverter"/>
        <localConv:BoolCNToVisibilityConverter x:Key="boolCNToVisibilityConverter"></localConv:BoolCNToVisibilityConverter>

        <Style x:Key="labelHeaderRibbonStyle" TargetType="{x:Type Label}">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontFamily" Value="Calibri" />
            <Setter Property="FontWeight" Value="Bold" />
        </Style>
        <Style x:Key="labelHeaderDetailRibbonStyle" TargetType="{x:Type Label}">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontFamily" Value="Calibri" />
            <Setter Property="FontWeight"  Value="Medium" />
        </Style>
        <Style x:Key="textHeaderDetailRibbonStyle" TargetType="{x:Type TextBlock}">
            <Setter Property="FontSize" Value="14" />
            <Setter Property="FontFamily" Value="Calibri" />
            <Setter Property="FontWeight"  Value="Medium" />
            <Setter Property="Margin" Value="0,5,0,0" />
        </Style>


        <Style x:Key="customCellStyle" TargetType="Syncfusion:VirtualizingCellsControl">
            <Setter Property="cal:Message.Attach" Value="[Event MouseDoubleClick] = [Action SelectItemByCell($dataContext)]"/>
        </Style>

        <Style x:Key="filterControlStyle" TargetType="Syncfusion:GridFilterControl">
            <Setter Property="FilterMode" Value="AdvancedFilter" />
        </Style>


        <Style x:Key="gridPvCellStyle" TargetType="Syncfusion:VirtualizingCellsControl">
            <!--<Setter Property="cal:Message.Attach" Value="[Event PreviewKeyDown] = [Action MovtosKeyDown($dataContext,$eventArgs)]"/>-->
        </Style>

        <Style x:Key="customCellStyleWithRowColor" TargetType="Syncfusion:VirtualizingCellsControl"  BasedOn="{StaticResource gridPvCellStyle}" >
            <Setter Property="Background" Value="{Binding Converter={StaticResource hexcolorconverter}}" />
            <Setter Property="Foreground" Value="{Binding Converter={StaticResource hexTextcolorconverter}}" />

        </Style>


    </UserControl.Resources>



    <DockPanel Name="MainDockPanel" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
               localConv:EnterKeyTraversal.IsEnabled="True" 
               cal:Message.Attach="[Event PreviewKeyDown] = [Action ControlKeyDown($eventArgs)]">
        <DockPanel DockPanel.Dock="Top" >
            <WrapPanel DockPanel.Dock="Top">

                <StackPanel HorizontalAlignment="Stretch">
                    <WrapPanel HorizontalAlignment="Stretch">
                        <Label  Style="{StaticResource labelHeaderRibbonStyle}">VENTAS</Label>
                    </WrapPanel>
                    <WrapPanel HorizontalAlignment="Stretch">
                        <Label  Style="{StaticResource labelHeaderRibbonStyle}">Fecha/Hora:</Label>
                        <TextBlock x:Name="testctrl" Style="{StaticResource textHeaderDetailRibbonStyle}" Text="{Binding CurrentDateTime_, StringFormat='{}{0:dd/MM/yy HH:mm}'}" />
                        <Label  Style="{StaticResource labelHeaderRibbonStyle}">Sucursal:</Label>
                        <Label  Style="{StaticResource labelHeaderDetailRibbonStyle}" Content="{Binding GlobalSession.CurrentSucursal.Nombre}" />
                        <Label  Style="{StaticResource labelHeaderRibbonStyle}">Cajero:</Label>
                        <Label  Style="{StaticResource labelHeaderDetailRibbonStyle}" Content="{Binding GlobalSession.CurrentUsuario.Nombre}"/>
                    </WrapPanel>
                </StackPanel>
            </WrapPanel>
            <Ribbon x:Name="RibbonWin" DockPanel.Dock="Bottom"  SelectedIndex="0" Width="{Binding ElementName=MainDockPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=x}"
                    KeyboardNavigation.ControlTabNavigation="None">

                <!-- Help Pane, located at the right-hand side -->
                <Ribbon.HelpPaneContent>
                    <RibbonButton SmallImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.Help}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" />
                </Ribbon.HelpPaneContent>
                <!-- Quick Access Toolbar - located at the upper-left corner -->
                <Ribbon.QuickAccessToolBar>
                    <RibbonQuickAccessToolBar >
                        <Label Style="{StaticResource labelHeaderRibbonStyle}">Transaccion:</Label>
                        <TextBlock Style="{StaticResource textHeaderDetailRibbonStyle}">
                            <TextBlock.Text>
                                <MultiBinding ConverterParameter="{} Folio {0} Serie: {1}"
                                                  Converter="{StaticResource StringFormatConverter}">
                                    <Binding Path="CurrentDocto.TipodoctoNombre"/>
                                    <Binding Path="CurrentDocto.Folio"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>

                        <TextBlock Style="{StaticResource textHeaderDetailRibbonStyle}" Visibility="{Binding Path=CurrentDocto.Docto_fact_elect_Esfacturaelectronica, Converter={StaticResource boolCNToVisibilityConverter}}">
                            <TextBlock.Text>
                                <MultiBinding  ConverterParameter="{} F.E. Folio {0} Serie {1}"
                                                  Converter="{StaticResource StringFormatConverter}">
                                    <Binding Path="CurrentDocto.Docto_fact_elect_Foliosat"/>
                                    <Binding Path="CurrentDocto.Docto_fact_elect_Seriesat"/>
                                </MultiBinding>
                            </TextBlock.Text>
                        </TextBlock>

                        <Label Style="{StaticResource labelHeaderRibbonStyle}">Estado:</Label>
                        <Label Style="{StaticResource labelHeaderDetailRibbonStyle}" Content="{Binding CurrentDocto.EstatusdoctoNombre}"/>
                        <Label Style="{StaticResource labelHeaderRibbonStyle}">Fecha/Hora Trans:</Label>
                        <TextBlock Style="{StaticResource textHeaderDetailRibbonStyle}" Text="{Binding CurrentDocto.Fecha, StringFormat='{}{0:dd/MM/yy HH:mm}'}" />
                        <Label Style="{StaticResource labelHeaderRibbonStyle}">Cajero Trans:</Label>
                        <Label Style="{StaticResource labelHeaderDetailRibbonStyle}" Content="{Binding CurrentDocto.UsuarioNombre}" /> 

                    </RibbonQuickAccessToolBar>
                </Ribbon.QuickAccessToolBar>
                <!-- Application Menu, located at the left-hand side (down arrow) -->
                <Ribbon.ApplicationMenu>
                    <RibbonApplicationMenu >
                        <RibbonApplicationMenuItem Header="Opciones" ImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.SettingsHelper}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" />
                        <RibbonApplicationMenuItem Header="Salir" ImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.ExitToApp}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" />
                    </RibbonApplicationMenu>
                </Ribbon.ApplicationMenu>

                <!-- Ribbon Tab #1: Home -->
                <RibbonTab Header="General"  >

                    <!-- Home  group-->
                    <RibbonGroup x:Name="ClipboardGroup" Header="General" >

                        <RibbonMenuButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconFontAwesomeKind.PlusCircleSolid}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}"  Label="Nueva"  >
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.TextBoxPlus}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" cal:Message.Attach="[Event Click]=[Action NuevaVenta()]" Label="Venta (F2)" IsEnabled="{cbind:Binding !BoolBindingExpression[NuevaVentaVacia]}"  />
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FileSwap}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Traslado"  IsEnabled="{cbind:Binding !BoolBindingExpression[NuevaTrasladoVacia]}" />
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.Warehouse}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Trasp. Almacen"  IsEnabled="{cbind:Binding !BoolBindingExpression[NuevaTrapasoAlmacenVacia]}" />
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.PageNext}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Venta a futuro"  IsEnabled="{cbind:Binding !BoolBindingExpression[NuevaVentaAFuturoVacia]}" />
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.CellphoneMessage}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Recargas"  IsEnabled="{cbind:Binding !BoolBindingExpression[NuevaRecargaVacia]}" />
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconFontAwesomeKind.FileInvoiceDollarSolid}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Pago servicio"  IsEnabled="{cbind:Binding !BoolBindingExpression[NuevaPagoServicioVacia]}" />
                            <!--<RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconFontAwesomeKind.FilePowerpointSolid}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Puntos BBVA"  />-->
                        </RibbonMenuButton>
                        <RibbonMenuButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FolderOpen}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}"  Label="Abrir"  >
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FolderLockOpen}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" cal:Message.Attach="[Event Click]=[Action AbrirVentaCerrada]" Label="Ventas cerradas (F5)"  />
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FolderOpenOutline}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" cal:Message.Attach="[Event Click]=[Action AbrirVentaPendiente]" Label="Ventas pendientes (F4)"  />
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.PoundBox}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Por Folio"  />
                        </RibbonMenuButton>
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.Cancel}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Cancelar (F3)"  KeyTip="X" cal:Message.Attach="[Event Click]=[Action CancelarDocto]" IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarCancelar]}" />
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.TableRowRemove}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Borrar detalle (F10)"  KeyTip="X" cal:Message.Attach="[Event Click]=[Action MovtoDeleteSelected]"  IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarPago]}"/>
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.Cash100}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Pagar (F6)"  KeyTip="X" cal:Message.Attach="[Event Click]=[Action Pagar()]" IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarPago]}"/>

                        <RibbonMenuButton  LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.Printer}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}"  Label="Imprimir"  IsEnabled="{cbind:Binding !BoolBindingExpression[NuevaVentaVacia]}" >
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.PrinterPos}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Imp. transaccion" cal:Message.Attach="[Event Click]=[Action ImprimirDocto]"  />
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.CloudPrint}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Imp. factura"  cal:Message.Attach="[Event Click]=[Action ImprimirFactura]" />
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconFontAwesomeKind.MoneyCheckSolid}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Reim. voucher" />
                        </RibbonMenuButton>

                        <RibbonMenuButton  LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FileSwap}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}"  Label="Traslado" >
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FileSwap}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Nuevo traslado" IsEnabled="{cbind:Binding !BoolBindingExpression[NuevaTrasladoVacia]}"/>
                            <TextBox x:Name="SucursalTClave" Text="{Binding CurrentDocto.Docto_traslado_SucursaltClave}" Margin="0,0,0,0"  HorizontalAlignment="Left" Width="50"   IsReadOnly="{cbind:Binding !BoolBindingExpression[EsTraslado]}" />
                            <TextBox x:Name="SucursalTNombre" Text="{Binding CurrentDocto.Docto_traslado_SucursaltNombre}" Margin="0,0,0,0"  HorizontalAlignment="Left" Width="100"  IsReadOnly="True" />

                            <Button  x:Name="SucursalTidButton" VerticalAlignment="Top" Margin="0,0,0,0" cal:Message.Attach="[Event Click] = [Action ShowPopUpSelector('Docto_traslado_SucursaltClave')]"  Width="24"  Height="24" Visibility="{cbind:Binding BoolBindingExpression[EsTraslado]}"  Style="{StaticResource MaterialDesignIconButton}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Binoculars"/>
                                </StackPanel>
                            </Button>

                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FileSend}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Reenviar traslado" />
                        </RibbonMenuButton>

                        <RibbonMenuButton  LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.Warehouse}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}"  Label="Almacen"  Visibility="{cbind:Binding BoolBindingExpression[ManejaAlmacen]}">
                            <RibbonMenuItem  Header="Almacen actual: " />
                            <ComboBox  x:Name="Alamcenid" 
			                       ItemsSource="{Binding Catalogs[Almacen]}"
                                   SelectedValuePath="Id" SelectedValue="{Binding CurrentDocto.Almacenid}"
                                   DisplayMemberPath="Nombre"  IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarAlmacen]}"/>
                            <RibbonMenuItem  Header="Almacen destino: " />
                            <ComboBox  x:Name="Alamcentid" 
			                       ItemsSource="{Binding Catalogs[Almacen]}"
                                   SelectedValuePath="Id" SelectedValue="{Binding CurrentDocto.Docto_traslado_Almacentid}"
                                   DisplayMemberPath="Nombre" IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarAlmacenDestino]}" />
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.Warehouse}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Nuevo traspaso" />
                        </RibbonMenuButton>


                        <RibbonMenuButton  LargeImageSource="{Binding Source={x:Static iconPacks:PackIconFontAwesomeKind.FileAltSolid}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}"  Label="Fact. Elect." >
                            <RibbonMenuItem  >
                                <RibbonMenuItem.Header>
                                    <MultiBinding ConverterParameter="{} Folio {0} Serie: {1}"
                                                  Converter="{StaticResource StringFormatConverter}">
                                        <Binding Path="CurrentDocto.Folio"/>
                                        <Binding Path="CurrentDocto.Serie"/>
                                    </MultiBinding>
                                </RibbonMenuItem.Header>
                            </RibbonMenuItem>
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.CloudPrint}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Imprimir fact." IsEnabled="{cbind:Binding BoolBindingExpression[EsFacturaElectronica]}"  cal:Message.Attach="[Event Click]=[Action ImprimirFactura]"/>
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FileReplace}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Convertir a fact." IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarConvertirFE]}"/>
                        </RibbonMenuButton>

                        <RibbonMenuButton  LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FileTableBoxMultiple}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}"  Label="Adjuntos" IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarAdjuntos]}">
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FormatListBulleted}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Lista Producto Adjuntos" Visibility="{cbind:Binding BoolBindingExpression[HabilitarAdjuntosVer]}" />
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.PlaylistPlus}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Agregar Producto adjunto" Visibility="{cbind:Binding BoolBindingExpression[HabilitarAdjuntosEditar]}" />
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FilePlus}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Agregar archivo adjunto" Visibility="{cbind:Binding BoolBindingExpression[HabilitarAdjuntosEditar]}"/>
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.MedicalBag}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Receta" Visibility="{cbind:Binding BoolBindingExpression[ManejaReceta]}"/>
                        </RibbonMenuButton>

                        <RibbonMenuButton  LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.SettingsHelper}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}"  Label=" + Opciones" >
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconFontAwesomeKind.BoxesSolid}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Validar existencia" IsEnabled="{cbind:Binding BoolBindingExpression[TransaccionEnBorrador]}"/>
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FileReplace}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Conv. venta fut. a venta" IsEnabled="{cbind:Binding BoolBindingExpression[EsVentaAFuturo]}"/>
                            <!--<RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.PlaylistEdit}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Editar venta" />-->
                        </RibbonMenuButton>


                    </RibbonGroup>

                    <!-- Cliente group-->
                    <RibbonGroup x:Name="ClienteRibbonSection" Header="Cliente">
                        <RibbonMenuButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.Account}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Cliente" >

                            <Label>
                                <TextBlock>
                                    <TextBlock.Text>
                                        <MultiBinding ConverterParameter="{}Domicilio: {0} Num. {1} {2} Col. {3}"
                                                  Converter="{StaticResource StringFormatConverter}">
                                            <Binding Path="CurrentCliente.Domicilio_Calle" />
                                            <Binding Path="CurrentCliente.Domicilio_Numeroexterior" />
                                            <Binding Path="CurrentCliente.Domicilio_Numerointerior" />
                                            <Binding Path="CurrentCliente.Domicilio_Colonia" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </Label>

                            <Label>
                                <TextBlock>
                                    <TextBlock.Text>
                                        <MultiBinding ConverterParameter="{}Ciudad: {0} Estado {1}"
                                                  Converter="{StaticResource StringFormatConverter}">
                                            <Binding Path="CurrentCliente.Domicilio_Ciudad" />
                                            <Binding Path="CurrentCliente.Domicilio_Estado" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </Label>

                            <Label>
                                <TextBlock>
                                    <TextBlock.Text>
                                        <MultiBinding ConverterParameter="{}C.P.: {0} Tel.: {1}"
                                                  Converter="{StaticResource StringFormatConverter}">
                                            <Binding Path="CurrentCliente.Domicilio_Codigopostal" />
                                            <Binding Path="CurrentCliente.Telefono1" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </Label>


                            <Label>
                                <TextBlock>
                                    <TextBlock.Text>
                                        <MultiBinding ConverterParameter="{}Limite: {0} Saldo: {1}"
                                                  Converter="{StaticResource StringFormatConverter}">
                                            <Binding Path="CurrentCliente.Cliente_pago_parametros_Limitecredito" />
                                            <Binding Path="CurrentCliente.Cliente_pago_Saldo" />
                                        </MultiBinding>
                                    </TextBlock.Text>
                                </TextBlock>
                            </Label>



                        </RibbonMenuButton>
                        <TextBox x:Name="ClienteClave" Text="{Binding CurrentDocto.ClienteClave}" Margin="0,0,0,0"  HorizontalAlignment="Left" Width="50"   IsReadOnly="{cbind:Binding !BoolBindingExpression[TransaccionEnBorrador]}" />
                        <TextBox x:Name="ClienteNombre" Text="{Binding CurrentDocto.ClienteNombre}" Margin="0,0,0,0"  HorizontalAlignment="Left" Width="100"  IsReadOnly="True" />
                        <Button  x:Name="ClienteidButton" VerticalAlignment="Top" Margin="0,0,0,0" cal:Message.Attach="[Event Click] = [Action ShowPopUpSelector('ClienteClave')]"  Width="24"  Height="24" Visibility="{cbind:Binding Path=BoolBindingExpression[TransaccionEnBorrador]}"  Style="{StaticResource MaterialDesignIconButton}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Binoculars"/>
                            </StackPanel>
                        </Button>
                    </RibbonGroup>



                    <!-- Employee And Payroll group-->
                    <RibbonGroup x:Name="VendedorRibbonSection" Header="Vendedor">
                        <RibbonMenuButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.AccountTie}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Vendedor" >
                            <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.BriefcaseAccount}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Cambiar vendedor ejecutivo" />
                            <RibbonMenuItem Header="{Binding CurrentDocto.Docto_comision_VendedorejecutivoNombre}"  />


                        </RibbonMenuButton>
                        <TextBox x:Name="Vendedorfinalclave" Text="{Binding CurrentDocto.Docto_comision_Vendedorfinal_Clave}" Margin="0,0,0,0"  HorizontalAlignment="Left" Width="50"   IsReadOnly="{cbind:Binding !BoolBindingExpression[TransaccionEnBorrador]}" />
                        <TextBox x:Name="Vendedorfinalnombre" Text="{Binding CurrentDocto.Docto_comision_Vendedorfinal_Nombre}" Margin="0,0,0,0"  HorizontalAlignment="Left" Width="100"  IsReadOnly="True" />
                        <Button  x:Name="VendedorfinalidButton" VerticalAlignment="Top" Margin="0,0,0,0" cal:Message.Attach="[Event Click] = [Action ShowPopUpSelector('Docto_comision_Vendedorfinal_Clave')]"  Width="24"  Height="24" Visibility="{cbind:Binding Path=BoolBindingExpression[TransaccionEnBorrador]}"  Style="{StaticResource MaterialDesignIconButton}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Binoculars"/>
                            </StackPanel>
                        </Button>
                    </RibbonGroup>

                    <RibbonGroup x:Name="SearchSection" Header="Buscar">
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.Magnify}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Buscar" />
                    </RibbonGroup>


                </RibbonTab>

                <!-- Ribbon Tab #2: Launch -->
                <RibbonTab Header="Cliente" >
                    <RibbonGroup x:Name="ClienteRibbonGroup" Header="Cliente">
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.Account}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Cliente" />
                        <TextBox x:Name="Clienteclave_" Text="{Binding CurrentDocto.ClienteClave}" Margin="0,0,0,0"  HorizontalAlignment="Left" Width="50"   IsReadOnly="{cbind:Binding !BoolBindingExpression[TransaccionEnBorrador]}" />
                        <TextBox x:Name="Clientenombre_" Text="{Binding CurrentDocto.ClienteNombre}" Margin="0,0,0,0"  HorizontalAlignment="Left" Width="100"  IsReadOnly="True" />
                        <Button  x:Name="ClienteidButton_" VerticalAlignment="Top" Margin="0,0,0,0" cal:Message.Attach="[Event Click] = [Action ShowPopUpSelector('ClienteClave')]"  Width="24"  Height="24" Visibility="{cbind:Binding Path=BoolBindingExpression[TransaccionEnBorrador]}"  Style="{StaticResource MaterialDesignIconButton}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Binoculars"/>
                            </StackPanel>
                        </Button>
                    </RibbonGroup>

                    <RibbonGroup x:Name="ClienteRibbonDatosGroup" Header="Datos">
                        <Label  Content="{Binding CurrentCliente.Rfc}"  ContentStringFormat="RFC: {0}" />
                        <Label  Content="{Binding CurrentCliente.Razonsocial}" ContentStringFormat="Razon social: {0}" />

                    </RibbonGroup>

                    <RibbonGroup x:Name="ClienteRibbonDomicilioGroup" Header="Domicilio">
                        <Label>
                            <TextBlock>
                                <TextBlock.Text>
                                    <MultiBinding ConverterParameter="{}Domicilio: {0} Num. {1} {2} Col. {3}"
                                                  Converter="{StaticResource StringFormatConverter}">
                                        <Binding Path="CurrentCliente.Domicilio_Calle" />
                                        <Binding Path="CurrentCliente.Domicilio_Numeroexterior" />
                                        <Binding Path="CurrentCliente.Domicilio_Numerointerior" />
                                        <Binding Path="CurrentCliente.Domicilio_Colonia" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </Label>

                        <Label>
                            <TextBlock>
                                <TextBlock.Text>
                                    <MultiBinding ConverterParameter="{}Ciudad: {0} Estado {1}"
                                                  Converter="{StaticResource StringFormatConverter}">
                                        <Binding Path="CurrentCliente.Domicilio_Ciudad" />
                                        <Binding Path="CurrentCliente.Domicilio_Estado" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </Label>

                        <Label>
                            <TextBlock>
                                <TextBlock.Text>
                                    <MultiBinding ConverterParameter="{}C.P.: {0} Tel.: {1}"
                                                  Converter="{StaticResource StringFormatConverter}">
                                        <Binding Path="CurrentCliente.Domicilio_Codigopostal" />
                                        <Binding Path="CurrentCliente.Telefono1" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </Label>

                    </RibbonGroup>

                    <RibbonGroup x:Name="ClienteRibbonSaldoGroup" Header="Saldo">

                        <Label>
                            <TextBlock>
                                <TextBlock.Text>
                                    <MultiBinding ConverterParameter="{}Limite: {0} Saldo: {1}"
                                                  Converter="{StaticResource StringFormatConverter}">
                                        <Binding Path="CurrentCliente.Cliente_pago_parametros_Limitecredito" />
                                        <Binding Path="CurrentCliente.Cliente_pago_Saldo" />
                                    </MultiBinding>
                                </TextBlock.Text>
                            </TextBlock>
                        </Label>

                    </RibbonGroup>
                </RibbonTab>

                <RibbonTab Header="Entrega - Cobranza" >

                    <RibbonGroup x:Name="RutaEntregaRibbonSaldoGroup" Header="Ruta Entrega">
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.TruckDelivery}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Ruta entrega" />
                        <Label  Content="{Binding CurrentDocto.Docto_rutaembarque_RutaembarqueNombre}"  ContentStringFormat="Ruta entrega: {0}" />
                    </RibbonGroup>
                    <RibbonGroup x:Name="CobranzaRibbonSaldoGroup" Header="Cobranza">
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.AccountCashOutline}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Cobranza" />
                    </RibbonGroup>
                </RibbonTab>

                <RibbonTab Header="Vendedor" >


                    <RibbonGroup x:Name="VendedorfinalGroup" Header="Vendedor final">
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.AccountTie}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Vendedor"  />
                        <TextBox x:Name="Vendedorfinalclave_" Text="{Binding CurrentDocto.Docto_comision_Vendedorfinal_Clave}" Margin="0,0,0,0"  HorizontalAlignment="Left" Width="50"   IsReadOnly="{cbind:Binding !BoolBindingExpression[TransaccionEnBorrador]}" />
                        <TextBox x:Name="Vendedorfinalnombre_" Text="{Binding CurrentDocto.Docto_comision_Vendedorfinal_Nombre}" Margin="0,0,0,0"  HorizontalAlignment="Left" Width="100"  IsReadOnly="True" />
                        <Button  x:Name="VendedorfinalidButton_" VerticalAlignment="Top" Margin="0,0,0,0" cal:Message.Attach="[Event Click] = [Action ShowPopUpSelector('Docto_comision_Vendedorfinal_Clave')]"  Width="24"  Height="24" Visibility="{cbind:Binding BoolBindingExpression[TransaccionEnBorrador]}"  Style="{StaticResource MaterialDesignIconButton}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Binoculars"/>
                            </StackPanel>
                        </Button>
                    </RibbonGroup>

                    <RibbonGroup x:Name="VendedorejecutivoGroup" Header="Vendedor ejecutivo">
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.BriefcaseAccount}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Vendedor Ejecutivo"  />
                        <TextBox x:Name="Vendedorejecutivoclave_" Text="{Binding CurrentDocto.Docto_comision_VendedorejecutivoClave}" Margin="0,0,0,0"  HorizontalAlignment="Left" Width="50"   IsReadOnly="{cbind:Binding !BoolBindingExpression[TransaccionEnBorrador]}" />
                        <TextBox x:Name="Vendedorejecutivonombre_" Text="{Binding CurrentDocto.Docto_comision_VendedorejecutivoNombre}" Margin="0,0,0,0"  HorizontalAlignment="Left" Width="100"  IsReadOnly="True" />
                        <Button  x:Name="VendedorejecutivoidButton_" VerticalAlignment="Top" Margin="0,0,0,0" cal:Message.Attach="[Event Click] = [Action ShowPopUpSelector('Docto_comision_VendedorejecutivoClave')]"  Width="24"  Height="24" Visibility="{cbind:Binding BoolBindingExpression[TransaccionEnBorrador]}"  Style="{StaticResource MaterialDesignIconButton}">
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Binoculars"/>
                            </StackPanel>
                        </Button>
                    </RibbonGroup>

                </RibbonTab>

                <RibbonTab Header="Pagos" >

                    <RibbonGroup x:Name="PagosGroup" Header="Pagos">
                        <RibbonButton x:Name="Pagar" LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.CurrencyUsd}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}"  Label="Pagar"  
                                      cal:Message.Attach="[Event Click] = [Action Pagar()]" IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarPago]}" />
                    </RibbonGroup>

                    <RibbonGroup x:Name="PagosValeGroup" Header="Pagos vale"  IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarPago]}">
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.TicketPercent}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Pagar con vale"  IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarPago]}" />
                    </RibbonGroup>


                    <RibbonGroup x:Name="NotasPagosGroup" Header="Notas">
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.NoteText}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Cambiar Nota pago"  IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarCambiarNotaPago]}" />
                        <RibbonMenuItem x:Name="Docto_info_pago_Notapago"  Header="{Binding CurrentDocto.Docto_info_pago_Notapago}" HeaderStringFormat="Nota: {0}" />
                    </RibbonGroup>

                    <RibbonGroup x:Name="PagoConTarjeta" Header="Pago con tarjeta">

                        <CheckBox x:Name="Pagocontarjeta"  IsChecked="{Binding CurrentDocto.Docto_info_pago_Pagocontarjeta, Converter={localConv:BooleanConverter}}" HorizontalAlignment="Center" Margin="10,0,10,0"  VerticalAlignment="Top"  
                                  IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarPago]}" Visibility="{cbind:Binding BoolBindingExpression[MostrarPagoConTarjeta]}" >
                            <TextBlock  Text="Pago con tarjeta" />
                        </CheckBox>
                        <CheckBox x:Name="ACredito"  IsChecked="{Binding CurrentDocto.Docto_info_pago_Pagoacredito, Converter={localConv:BooleanConverter}}" HorizontalAlignment="Center" Margin="10,0,10,0"  VerticalAlignment="Top"  
                                  IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarPago]}" Visibility="{cbind:Binding BoolBindingExpression[MostrarACredito]}" >
                            <TextBlock  Text="A credito" />
                        </CheckBox>
                    </RibbonGroup>

                </RibbonTab>

                <RibbonTab  Header="Traslados" >
                    <RibbonGroup  x:Name="TrasladosGroup" Header="Nuevo" >
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FileSwap}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Nuevo traslado" IsEnabled="{cbind:Binding !BoolBindingExpression[NuevaTrasladoVacia]}" />

                    </RibbonGroup>
                    <RibbonGroup   Header="Sucursal destino" >
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <Label Content="Sucursal destino:" Grid.Column="0"/>
                            <TextBox x:Name="SucursalTclave_" Grid.Column="1" Text="{Binding CurrentDocto.Docto_traslado_SucursaltClave}" Margin="5,0,5,0"  HorizontalAlignment="Left" Width="50"   IsReadOnly="{cbind:Binding !BoolBindingExpression[HabilitarSucursalDestino]}" />
                            <TextBox x:Name="SucursalTnombre_" Grid.Column="2" Text="{Binding CurrentDocto.Docto_traslado_SucursaltNombre}" Margin="5,0,5,0"  HorizontalAlignment="Left" Width="100"  IsReadOnly="True" />
                            <Button  x:Name="SucursalTidButton_" Grid.Column="3" VerticalAlignment="Top" Margin="0,0,0,0" cal:Message.Attach="[Event Click] = [Action ShowPopUpSelector('Docto_traslado_SucursaltClave')]"  Width="24"  Height="24" Visibility="{cbind:Binding BoolBindingExpression[HabilitarSucursalDestino]}"  Style="{StaticResource MaterialDesignIconButton}">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Binoculars"/>
                                </StackPanel>
                            </Button>
                        </Grid>
                    </RibbonGroup>
                    <RibbonGroup   Header="Reenviar" >
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FileSend}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Reenviar traslado" IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarReenviarTraslado]}"/>
                    </RibbonGroup>

                </RibbonTab>

                <RibbonTab Header="Traspasos" >
                    <RibbonGroup x:Name="TraspasosGroup" Header="Traspasos">
                        <RibbonMenuItem  Header="Almacen actual: " />
                        <ComboBox  x:Name="Almacenid_" 
			                       ItemsSource="{Binding Catalogs[Almacen]}"
                                   SelectedValuePath="Id" SelectedValue="{Binding CurrentDocto.Almacenid}"
                                   DisplayMemberPath="Nombre" IsReadOnly="{cbind:Binding !BoolBindingExpression[HabilitarAlmacen]}" />
                        <RibbonMenuItem  Header="Almacen destino: " />
                        <ComboBox  x:Name="Alamcentid_" 
			                       ItemsSource="{Binding Catalogs[Almacen]}"
                                   SelectedValuePath="Id" SelectedValue="{Binding CurrentDocto.Docto_traslado_Almacentid}"
                                   DisplayMemberPath="Nombre" IsReadOnly="{cbind:Binding !BoolBindingExpression[HabilitarAlmacenDestino]}" />
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.Warehouse}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Nuevo traspaso" />
                    </RibbonGroup>
                </RibbonTab>

                <RibbonTab Header="Fact. Elect." >

                    <RibbonGroup x:Name="FactElectGroup" Header="Factura electronica">
                        <RibbonMenuItem  >
                            <RibbonMenuItem.Header>
                                <MultiBinding ConverterParameter="{} Folio {0} Serie: {1}"
                                                  Converter="{StaticResource StringFormatConverter}">
                                    <Binding Path="CurrentDocto.Docto_fact_elect_Foliosat"/>
                                    <Binding Path="CurrentDocto.Docto_fact_elect_Seriesat"/>
                                </MultiBinding>
                            </RibbonMenuItem.Header>
                        </RibbonMenuItem>
                        <RibbonMenuItem  >
                            <RibbonMenuItem.Header>
                                <MultiBinding ConverterParameter="{} Folio {0} Serie: {1}"
                                                  Converter="{StaticResource StringFormatConverter}">
                                    <Binding Path="CurrentDocto.Folio"/>
                                    <Binding Path="CurrentDocto.Serie"/>
                                </MultiBinding>
                            </RibbonMenuItem.Header>
                        </RibbonMenuItem>
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.CloudPrint}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Imprimir fact." IsEnabled="{cbind:Binding BoolBindingExpression[EsFacturaElectronica]}"/>
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FileReplace}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Convertir a fact." IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarConvertirFE]}" />
                    </RibbonGroup>
                </RibbonTab>

                <RibbonTab Header="Adjuntos" >

                    <RibbonGroup x:Name="AdjuntosGroup" Header="Adjuntos"  IsEnabled="{cbind:Binding BoolBindingExpression[HabilitarAdjuntos]}">
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FormatListBulleted}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Lista Producto Adjuntos" Visibility="{cbind:Binding BoolBindingExpression[HabilitarAdjuntosVer]}" />
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.PlaylistPlus}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Agregar Producto adjunto" Visibility="{cbind:Binding BoolBindingExpression[HabilitarAdjuntosEditar]}"/>
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.FilePlus}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Agregar archivo adjunto" Visibility="{cbind:Binding BoolBindingExpression[HabilitarAdjuntosEditar]}" />
                        <RibbonButton LargeImageSource="{Binding Source={x:Static iconPacks:PackIconMaterialKind.MedicalBag}, Converter={StaticResource PackIconImageSourceConverter}, ConverterParameter={StaticResource IconBrush}}" Label="Receta" Visibility="{cbind:Binding BoolBindingExpression[ManejaReceta]}"/>
                    </RibbonGroup>
                </RibbonTab>

            </Ribbon>
        </DockPanel>

        <ScrollViewer  DockPanel.Dock="Bottom" Width="{Binding ElementName=MainDockPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=x}" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto" Margin="0,0,0,0"  IsEnabled="{cbind:Binding Path=!IsBusy}" Opacity="{Binding Opacity}">
            <WrapPanel Name="MainPanel"  HorizontalAlignment="Stretch"   VerticalAlignment="Top" Height="Auto"  >
                <StackPanel MinWidth="110" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=x}"  Height="5"  >
                    <localCont:MessageBoxV2 MessageToUser="{Binding MessageToUser}"  Width="10"  HorizontalAlignment="Right"/>
                </StackPanel>
                <StackPanel MinWidth="110"  Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=x}" >

                    <WrapPanel Width="{Binding ElementName=MainDockPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=x}">
                        <StackPanel HorizontalAlignment="Stretch">


                            <ac:AdornedControl IsAdornerVisible="{Binding IsBusyMovtoList}">
                                <ac:AdornedControl.AdornerContent>
                                    <localCont:LoadingWait></localCont:LoadingWait>
                                </ac:AdornedControl.AdornerContent>

                                <Syncfusion:SfDataGrid x:Name="SfTableDataGridView" 
                                    ItemsSource="{Binding MovtoItems}" 
                                    RowStyle="{StaticResource customCellStyleWithRowColor}"
                                    SelectionMode="Extended"
                                    localConv:SfGridSelectedItemBehaviour.SelectedItems="{Binding SelectedMovtoItems, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                     cal:Message.Attach="[Event PreviewKeyDown] = [Action MovtoGridKeyDown($eventArgs)]"
                                    AllowFiltering="True" AllowEditing="True"
                                    FilterPopupStyle="{StaticResource filterControlStyle}"
                                    Margin="2,2,2,2"  AutoGenerateColumns="False"    
                                    Background="{Binding StringBindingExpression[DataGridBackground]}" 
                                    IsReadOnly="{cbind:Binding !BoolBindingExpression[TransaccionEnBorrador]}" RowHeight="35"   
                                   MinWidth="100" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=x}" HorizontalAlignment="Stretch"
                                    Height="{Binding ElementName=MainDockPanel, Path=ActualHeight, Converter={localConv:MathConverter}, ConverterParameter=20*x/60}" MinHeight="150" Loaded="SfTableDataGridView_Loaded"
                                    >
                                    <Syncfusion:SfDataGrid.Columns>

                                        <Syncfusion:GridNumericColumn  HeaderText="Cantidad" MappingName="Cantidad" ColumnSizer="None" Width="10"
                                                                        NumberDecimalDigits="3" NumberDecimalSeparator="." NumberGroupSizes="3" NumberGroupSeparator="," />

                                        <Syncfusion:GridTextColumn  HeaderText="Descripcion" MappingName="Descripcion1" ColumnSizer="None" Width="34" />

                                        <Syncfusion:GridNumericColumn  HeaderText="Precio s/i c/u " MappingName="Precio" ColumnSizer="None"  Width="11" TextAlignment="Right" 
                                                                        IsHidden="True" NumberDecimalDigits="2" NumberDecimalSeparator="." NumberGroupSizes="3" NumberGroupSeparator="," />

                                        <Syncfusion:GridNumericColumn  HeaderText="Precio c/u" MappingName="Preciomostrar" ColumnSizer="None"  Width="11" TextAlignment="Right" 
                                                                        NumberDecimalDigits="2" NumberDecimalSeparator="." NumberGroupSizes="3" NumberGroupSeparator="," />

                                        <Syncfusion:GridNumericColumn  HeaderText="%IVA" MappingName="Tasaiva" ColumnSizer="None"  Width="7" TextAlignment="Right"
                                                                        NumberDecimalDigits="2" NumberDecimalSeparator="." NumberGroupSizes="3" NumberGroupSeparator=","/>

                                        <Syncfusion:GridNumericColumn  HeaderText="%IEPS" MappingName="Tasaieps" ColumnSizer="None"  Width="7" TextAlignment="Right"
                                                                        NumberDecimalDigits="2" NumberDecimalSeparator="." NumberGroupSizes="3" NumberGroupSeparator=","/>

                                        <Syncfusion:GridNumericColumn  HeaderText="%D" MappingName="Descuentoporcentaje" ColumnSizer="None"  Width="7" TextAlignment="Right"
                                                                        NumberDecimalDigits="2" NumberDecimalSeparator="." NumberGroupSizes="3" NumberGroupSeparator=","/>

                                        <Syncfusion:GridNumericColumn  HeaderText="Desc." MappingName="Descuentomostrar" ColumnSizer="None"  Width="9" TextAlignment="Right"
                                                                        NumberDecimalDigits="2" NumberDecimalSeparator="." NumberGroupSizes="3" NumberGroupSeparator=","/>

                                        <Syncfusion:GridNumericColumn  HeaderText="Importe" MappingName="Total" ColumnSizer="None"  Width="13" TextAlignment="Right"
                                                                        NumberDecimalDigits="2" NumberDecimalSeparator="." NumberGroupSizes="3" NumberGroupSeparator=","/>

                                        <Syncfusion:GridTextColumn  HeaderText="Descripcion 2" MappingName="Descripcion2"  Width="18"/>

                                        <Syncfusion:GridTextColumn  HeaderText="Lote" MappingName="Lote"  Width="11"/>

                                        <Syncfusion:GridTextColumn  HeaderText="Unidad" MappingName="Unidadnombre"  Width="11"/>


                                        <Syncfusion:GridTextColumn  HeaderText="Desc vale" MappingName="Descuentovale"  Width="11"/>

                                        <Syncfusion:GridTextColumn  HeaderText="%Desc vale" MappingName="Descuentovaleporcentaje"  Width="11"/>

                                        <Syncfusion:GridTextColumn  HeaderText="P manual" MappingName="Ingresopreciomanual"  Width="11"/>

                                        <Syncfusion:GridTextColumn  HeaderText="% D manual" MappingName="Porcentajedescuentomanual"  Width="11"/>

                                        <Syncfusion:GridTextColumn  HeaderText="Existencia" MappingName="Existencia"  Width="11"/>
                                      



                                    </Syncfusion:SfDataGrid.Columns>
                                </Syncfusion:SfDataGrid>
                            </ac:AdornedControl>


                        </StackPanel>
                    </WrapPanel>




                    <WrapPanel HorizontalAlignment="Stretch">
                        <StackPanel HorizontalAlignment="Stretch" Margin="10,0,0,20">
                            <TextBlock Style="{StaticResource MaterialDesignHeadline6TextBlock}" FontWeight="Medium"  HorizontalAlignment="Stretch"  VerticalAlignment="Top"></TextBlock>
                            <Border BorderThickness="0,2,0,0"  BorderBrush="LightBlue" VerticalAlignment="Top" >
                                <WrapPanel Margin="0,10,0,0" VerticalAlignment="Top">

                                    <WrapPanel Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=8.8*x/12.5}"
                                               IsEnabled="{cbind:Binding BoolBindingExpression[TransaccionEnBorrador]}">
                                        <StackPanel MinWidth="110" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=2.5*x/12.5}"  Height="85"  >
                                            <Label Style="{DynamicResource LabelFieldFormTemplate}" Margin="10,0,10,0"  Content="Producto" />


                                            <localConv:SfTextBoxExt2 x:Name="P_productoclave"
                                             Text="{Binding CurrentMovto.ProductoClave}" 
                                                 HorizontalAlignment="Stretch" 
                                                 VerticalAlignment="Center"
                                                 Margin="0,0,6,0"
                                                 IsReadOnly="{Binding BIsReadOnly}" 
                                                 IsHitTestVisible="True"
                                                 ForceCursor="True"
                                                 BorderThickness="0,0,0,2"
                                            BorderBrush="DarkGray"
                                            Background="#F9F9F9F9"
                                                 localCommon:InputBindingsManager.UpdatePropertySourceWhenEnterPressed="localConv:SfTextBoxExt2.Text"
                                                 cal:Message.Attach="[Event PreviewKeyDown] = [Action ProductoKeyDown($eventArgs)]"
                                            
                                                            Height="30"
                                                            SearchItemPath="Text"
                                                            SuggestionMode="Contains"
                                                            AutoCompleteMode="Suggest"
                                                            AutoCompleteSource="{Binding GlobalSession.ListadoAutoCompleteProd}" />


                                            <TextBlock Style="{DynamicResource TextErrorStyleTemplate}"  Text="{Binding (Validation.Errors), Converter={localConv:ValidationErrorConverter}, ConverterParameter=0, ElementName=P_productoclave}"  Margin="0,0,0,0"/>
                                        </StackPanel>


                                        <StackPanel MinWidth="50" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=x/12.5}"  Height="85" Visibility="{cbind:Binding Path=CajasBotellasActive}" >
                                            <Label  Style="{DynamicResource LabelFieldFormTemplate}" Margin="10,0,10,0"  Content="Cajas" />
                                            <Syncfusion:DoubleTextBox x:Name="P_cajas" HorizontalAlignment="Stretch"  Margin="10,0,10,0" NumberGroupSeparator="," NumberDecimalDigits="0" NumberDecimalSeparator="." TextWrapping="Wrap" Text="DoubleTextBox" Value="{Binding Cajas}" VerticalAlignment="Top"  IsScrollingOnCircle="False" IsReadOnly="{Binding BIsReadOnly}" />
                                            <TextBlock Style="{DynamicResource TextErrorStyleTemplate}"  Text="{Binding (Validation.Errors), Converter={localConv:ValidationErrorConverter}, ConverterParameter=0, ElementName=P_cajas}"  Margin="0,0,0,0"/>
                                        </StackPanel>

                                        <StackPanel MinWidth="50" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=1.6*x/12.5}"  Height="85"  >
                                            <Label  Style="{DynamicResource LabelFieldFormTemplate}" Margin="10,0,10,0"  Content="Cantidad" />
                                            <Syncfusion:DoubleTextBox x:Name="P_cantidad" HorizontalAlignment="Stretch"  Margin="10,0,10,0" NumberGroupSeparator="," NumberDecimalDigits="2" NumberDecimalSeparator="." TextWrapping="Wrap" Text="DoubleTextBox" Value="{Binding CurrentMovto.Cantidad}" VerticalAlignment="Top"  IsScrollingOnCircle="False" IsReadOnly="{Binding BIsReadOnly}" IsEnabled="{cbind:Binding CantidadEnabled}" 
                                                 ForceCursor="True" 
                                                 localCommon:InputBindingsManager.UpdatePropertySourceWhenEnterPressed="Syncfusion:DoubleTextBox.Value"
                                                 cal:Message.Attach="[Event PreviewKeyDown] = [Action CantidadKeyDown($eventArgs)]" />
                                            <TextBlock Style="{DynamicResource TextErrorStyleTemplate}"  Text="{Binding (Validation.Errors), Converter={localConv:ValidationErrorConverter}, ConverterParameter=0, ElementName=P_cantidad}"  Margin="0,0,0,0"/>
                                        </StackPanel>

                                        <StackPanel MinWidth="50" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=1.6*x/12.5}"  Height="85"  >
                                            <Label Style="{DynamicResource LabelFieldFormTemplate}" Margin="10,0,10,0"  Content="Precio" />
                                            <SfExt:DoubleTextBoxNoUpDown x:Name="P_precio" HorizontalAlignment="Stretch"  Margin="10,0,10,0" NumberGroupSeparator="," NumberDecimalDigits="2" NumberDecimalSeparator="." TextWrapping="Wrap" Text="DoubleTextBox" Value="{Binding CurrentMovto.Precio}" VerticalAlignment="Top"  IsScrollingOnCircle="False" IsReadOnly="{cbind:Binding !PrecioEnabled}" 
                                                 ForceCursor="True" 
                                                 Step="0"
                                                 localCommon:InputBindingsManager.UpdatePropertySourceWhenEnterPressed="SfExt:DoubleTextBoxNoUpDown.Value"
                                                 cal:Message.Attach="[Event PreviewKeyDown] = [Action PrecioKeyDown($eventArgs)]"/>
                                            <ListBox x:Name="P_precioLista" SelectedValue="{Binding SelectedListPrice}"  SelectedValuePath="Value" BorderThickness="0" ItemsSource="{Binding ListaPrecios}" ScrollViewer.VerticalScrollBarVisibility="Visible" Height="30" Visibility="{cbind:Binding ListaPrecioEnabled}"
                                                 cal:Message.Attach="[Event LostFocus] = [Action ListPriceLostFocus]" >
                                                <ListBox.ItemTemplate>
                                                    <DataTemplate>
                                                        <TextBlock Text="{Binding Key}"/>
                                                    </DataTemplate>
                                                </ListBox.ItemTemplate>
                                            </ListBox>

                                            <TextBlock Style="{DynamicResource TextErrorStyleTemplate}"  Text="{Binding (Validation.Errors), Converter={localConv:ValidationErrorConverter}, ConverterParameter=0, ElementName=P_precio}"  Margin="0,0,0,0"/>
                                        </StackPanel>

                                        <StackPanel MinWidth="50" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=0.8*x/12.5}"  Height="85"  >
                                            <Label Style="{DynamicResource LabelFieldFormTemplate}" Margin="10,0,10,0"  Content="% Desc." />
                                            <Syncfusion:DoubleTextBox x:Name="P_descuentoporcentaje" HorizontalAlignment="Stretch"  Margin="10,0,10,0" NumberGroupSeparator="," NumberDecimalDigits="2" NumberDecimalSeparator="." TextWrapping="Wrap" Text="DoubleTextBox" Value="{Binding CurrentMovto.Descuentoporcentaje}" VerticalAlignment="Top"  IsScrollingOnCircle="False" IsReadOnly="{cbind:Binding !DescuentoEnabled}" 
                                                ForceCursor="True" 
                                                localCommon:InputBindingsManager.UpdatePropertySourceWhenEnterPressed="Syncfusion:DoubleTextBox.Value"
                                                cal:Message.Attach="[Event PreviewKeyDown] = [Action DescuentoporcentajeKeyDown($eventArgs)]" />
                                            <TextBlock Style="{DynamicResource TextErrorStyleTemplate}"  Text="{Binding (Validation.Errors), Converter={localConv:ValidationErrorConverter}, ConverterParameter=0, ElementName=P_descuentoporcentaje}"  Margin="0,0,0,0"/>
                                        </StackPanel>


                                        <StackPanel MinWidth="50" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=0.6*x/12.5}"  Height="85"  >
                                            <Label Margin="10,0,10,0"  Content=" " />
                                            <Button  Margin="6" Padding="6"
                                            x:Name="SaveMovto" Content="Ok"  Foreground="WhiteSmoke"/>
                                        </StackPanel>

                                        <StackPanel MinWidth="50" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=0.6*x/12.5}"  Height="85"  >
                                            <Label Margin="10,0,10,0"  Content=" " />
                                            <Button  Margin="6" Padding="6"
                                            x:Name="CancelMovto"
                                            Content="X" Visibility="{cbind:Binding Path=!BIsReadOnly}" Background="LightGray"/>
                                        </StackPanel>


                                        <StackPanel MinWidth="110" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=6*x/12.5}"  Height="65"  >
                                            <Label Margin="10,0,10,0"  Content=" " />
                                            <TextBox x:Name="ProductoNombre" Text="{Binding CurrentMovto.DescripcionProductoMovto}" Margin="10,0,10,0" IsReadOnly="True"  Background="#F9F9F9F9"    />
                                        </StackPanel>

                                        <StackPanel MinWidth="20" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=1.20*x/12.5}"  Height="65"  >
                                            <Label Margin="10,0,10,0"  Content=" " />
                                            <Button  Margin="6" Padding="6" Content="Pagar(F6)" cal:Message.Attach="[Event Click]=[Action Pagar()]"  Foreground="WhiteSmoke"/>
                                        </StackPanel>

                                    </WrapPanel>


                                    <WrapPanel Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=3.2*x/12.5}">
                                        <Grid MinWidth="110" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=3*x/12.5}" ShowGridLines="False">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"></ColumnDefinition>
                                                <ColumnDefinition Width="3*"></ColumnDefinition>
                                                <ColumnDefinition Width="3*"></ColumnDefinition>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                                <RowDefinition></RowDefinition>
                                            </Grid.RowDefinitions>
                                            <Label Content="Subtotal:" Grid.Row="0" Grid.Column="1" FontSize="16" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Right"></Label>
                                            <Label Content="{Binding CurrentDocto.Subtotal}" ContentStringFormat="N2" Grid.Row="0" Grid.Column="2" FontSize="16" VerticalAlignment="Center" HorizontalAlignment="Right"></Label>
                                            <Label Content="Ieps:" Grid.Row="1" Grid.Column="1" FontSize="16" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Right"></Label>
                                            <Label Content="{Binding CurrentDocto.Ieps}" ContentStringFormat="N2" Grid.Row="1" Grid.Column="2" FontSize="16" VerticalAlignment="Center" HorizontalAlignment="Right"></Label>
                                            <Label Content="Iva:" Grid.Row="2" Grid.Column="1" FontSize="16" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Right"></Label>
                                            <Label Content="{Binding CurrentDocto.Iva}"  ContentStringFormat="N2" Grid.Row="2" Grid.Column="2" FontSize="16" VerticalAlignment="Center" HorizontalAlignment="Right"></Label>
                                            <Label Content="Total:" Grid.Row="3" Grid.Column="1" FontSize="16" FontWeight="Bold" VerticalAlignment="Center" HorizontalAlignment="Right"></Label>
                                            <Label Content="{Binding CurrentDocto.Total}" ContentStringFormat="N2" Grid.Row="3" Grid.Column="2" FontSize="16" VerticalAlignment="Center" HorizontalAlignment="Right"></Label>
                                        </Grid>
                                    </WrapPanel>





                                </WrapPanel>
                            </Border>
                        </StackPanel>
                    </WrapPanel>





                    <WrapPanel Width="{Binding ElementName=MainDockPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=12*x/12.5}">
                        <StackPanel HorizontalAlignment="Stretch">
                            <Label Style="{DynamicResource LabelGroupFormTemplate}" Content=""  HorizontalAlignment="Stretch"  VerticalAlignment="Top"/>
                            <Border BorderThickness="0,2,0,0" BorderBrush="#AAAAAA"  >
                                <WrapPanel>

                                    <Label Content="{Binding DerechosUsuario[10]}"/>

                                </WrapPanel>
                            </Border>
                        </StackPanel>
                    </WrapPanel>



                </StackPanel>




            </WrapPanel>
        </ScrollViewer>
    </DockPanel>


        
</UserControl>