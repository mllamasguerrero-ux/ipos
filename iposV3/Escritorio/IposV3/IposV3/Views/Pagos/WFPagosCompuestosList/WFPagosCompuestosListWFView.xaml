
<UserControl
        x:Class="IposV3.Views.WFPagosCompuestosListWFView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:cal="http://www.caliburnproject.org"
        xmlns:Syncfusion="http://schemas.syncfusion.com/wpf" 
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:cbind="clr-namespace:CalcBinding;assembly=CalcBinding"
        xmlns:SfExt="clr-namespace:SyncfusionExt;assembly=UICommon"
        xmlns:local="clr-namespace:IposV3"
            xmlns:localCommon="clr-namespace:UICommon;assembly=UICommon"
        xmlns:localCont="clr-namespace:Controls;assembly=UICommon"
        xmlns:localConv="clr-namespace:Converters;assembly=UICommon"
        xmlns:ac="clr-namespace:AdornedControl;assembly=AdornedControl"
        mc:Ignorable="d"  
        VerticalAlignment="Stretch"
        Width="{Binding Source={x:Static SystemParameters.PrimaryScreenWidth}, Converter={localConv:WindowSizeConverter}, ConverterParameter='0.98'}"
        >
    <UserControl.Resources>
        <localConv:DecimalNullableConverter x:Key="DecimalNullableConverter"/>
        <localConv:IntNullableConverter x:Key="IntNullableConverter"/>
        <localConv:DateTimeOffsetToDateTimeConverter x:Key="DateTimeOffsetToDateTimeConverter"/>

        <Style x:Key="customCellStyle" TargetType="Syncfusion:VirtualizingCellsControl">
            <!--<Setter Property="cal:Message.Attach" Value="[Event MouseDoubleClick] = [Action SelectItemByCell($dataContext)]"/>-->
        </Style>

        <Style x:Key="filterControlStyle" TargetType="Syncfusion:GridFilterControl">
            <Setter Property="FilterMode" Value="AdvancedFilter" />
        </Style>

        <x:Array x:Key="AplicadosListString" Type="localConv:ComboBoxItemString">
            <localConv:ComboBoxItemString ValueString = "Todos" />
            <localConv:ComboBoxItemString ValueString = "Aplicados"/>
            <localConv:ComboBoxItemString ValueString = "No Aplicados"/>
        </x:Array>

        <x:Array x:Key="TimbradosListString" Type="localConv:ComboBoxItemString">
            <localConv:ComboBoxItemString ValueString = "Todos" />
            <localConv:ComboBoxItemString ValueString = "Timbrados"/>
            <localConv:ComboBoxItemString ValueString = "No Timbrados"/>
        </x:Array>

    </UserControl.Resources>


    <ScrollViewer x:Name="MainScrollViewer"  HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto" Padding="20,20,20,20" Margin="0 0 0 0 "  IsEnabled="{cbind:Binding Path=!IsBusy}" Opacity="{Binding Opacity}">
        <WrapPanel Name="MainPanel"  HorizontalAlignment="Stretch"  VerticalAlignment="Top"  >
            <StackPanel MinWidth="110" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=x}"  Height="5"  >
                <localCont:MessageBoxV2 MessageToUser="{Binding MessageToUser}"  Width="10"  HorizontalAlignment="Right"/>
            </StackPanel>



             <WrapPanel  HorizontalAlignment="Stretch"  VerticalAlignment="Top"  IsEnabled="{cbind:Binding Path=!IsBusy}">


              <WrapPanel Margin="0,20,0,0" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=12.5*x/12.5}">

                <Button  x:Name="Back" Style="{StaticResource MaterialDesignIconButton}">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="ArrowLeft"/>
                    </StackPanel>
                </Button>
                    <TextBlock Style="{StaticResource MaterialDesignBody1TextBlock}">Lista de pagos</TextBlock>
              </WrapPanel>
                 

                        <StackPanel VerticalAlignment="Top" HorizontalAlignment="Left" Margin="20,0,20,0">


                            <WrapPanel Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=12*x/12.5}">
                                <StackPanel HorizontalAlignment="Stretch" Margin="2,0,2,2">
                                    <Border BorderThickness="0,2,0,0" BorderBrush="LightBlue"  >
                                        <WrapPanel Margin="0,10,0,0">

                                            <WrapPanel Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=12*x/12.5}">


                                                <StackPanel MinWidth="110" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=3*x/12.5}"  Height="75"  >
                                                    <Label Style="{DynamicResource LabelFieldFormTemplate}" Margin="10,0,10,0"  Content="Forma de pago" />
                                                    <ComboBox  x:Name="Formapagoid" 
			                                                       ItemsSource="{Binding Catalogs[Formapago]}"
                                                                   SelectedValuePath="Id"
                                                                   SelectedValue="{Binding V_pagos_compuestos_list_selItem.Formapagoid}"
                                                                   DisplayMemberPath="Nombre" />
                                                    <TextBlock Style="{DynamicResource TextErrorStyleTemplate}"  Text="{Binding (Validation.Errors), Converter={localConv:ValidationErrorConverter}, ConverterParameter=0, ElementName=Formapagoid}"  Margin="0,0,0,0"/>
                                                </StackPanel>


                                                <StackPanel Visibility="{cbind:Binding Path=EsTransaccionDeSalida}" 
                                                    MinWidth="110" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=3*x/12.5}"  Height="75"   >
                                                    <Label Style="{DynamicResource LabelFieldFormTemplate}" Margin="10,0,10,0"  Content="Cliente" />
                                                    <WrapPanel>
                                                        <TextBox x:Name="ClienteClave" Text="{Binding V_pagos_compuestos_list_selItem.Clienteclave}" Margin="10,0,10,0"  HorizontalAlignment="Left" Width="50" />
                                                        <TextBox x:Name="ClienteNombre" Text="{Binding V_pagos_compuestos_list_selItem.Clientenombre}" Margin="10,0,10,0"  HorizontalAlignment="Left" Width="150"  IsReadOnly="True" />
                                                        <Button  x:Name="ClienteidButton" VerticalAlignment="Top" Margin="10,0,10,0" cal:Message.Attach="[Event Click] = [Action ShowPopUpSelector('Clienteclave')]"  Width="24"  Height="24"  Style="{StaticResource MaterialDesignIconButton}">
                                                            <StackPanel Orientation="Horizontal">
                                                                <materialDesign:PackIcon Kind="Binoculars"/>
                                                            </StackPanel>
                                                        </Button>
                                                    </WrapPanel>
                                                    <TextBlock Style="{DynamicResource TextErrorStyleTemplate}"  Text="{Binding (Validation.Errors), Converter={localConv:ValidationErrorConverter}, ConverterParameter=0, ElementName=ClienteClave}"  Margin="0,0,0,0"/>
                                                </StackPanel>



                                                <StackPanel  Visibility="{cbind:Binding Path=!EsTransaccionDeSalida}"  
                                                MinWidth="110" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=3*x/12.5}"  Height="75"  >
                                                    <Label Style="{DynamicResource LabelFieldFormTemplate}" Margin="10,0,10,0"  Content="Proveedor" />
                                                    <WrapPanel>
                                                        <TextBox x:Name="Proveedorclave" Text="{Binding V_pagos_compuestos_list_selItem.Proveedorclave}" Margin="10,0,10,0"  HorizontalAlignment="Left" Width="50"    />
                                                        <TextBox x:Name="Proveedornombre" Text="{Binding V_pagos_compuestos_list_selItem.Proveedornombre}" Margin="10,0,10,0"  HorizontalAlignment="Left" Width="100"  IsReadOnly="True" />
                                                        <Button  x:Name="ProveedoridButton" VerticalAlignment="Top" Margin="10,0,10,0" cal:Message.Attach="[Event Click] = [Action ShowPopUpSelector('Proveedorclave')]"  Width="24"  Height="24"   Style="{StaticResource MaterialDesignIconButton}">
                                                            <StackPanel Orientation="Horizontal">
                                                                <materialDesign:PackIcon Kind="Binoculars"/>
                                                            </StackPanel>
                                                        </Button>
                                                    </WrapPanel>
                                                    <TextBlock Style="{DynamicResource TextErrorStyleTemplate}"  Text="{Binding (Validation.Errors), Converter={localConv:ValidationErrorConverter}, ConverterParameter=0, ElementName=ClienteClave}"  Margin="0,0,0,0"/>
                                                </StackPanel>



                                                <StackPanel MinWidth="110" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=1.5*x/12.5}"  Height="75"  >
                                                    <Label Style="{DynamicResource LabelFieldFormTemplate}" Margin="10,0,10,0"  Content="Fecha inicial" />
                                                    <DatePicker x:Name="Fechainicial" HorizontalAlignment="Left" Margin="78,10,0,0"  VerticalAlignment="Top" SelectedDate="{Binding Converter={StaticResource DateTimeOffsetToDateTimeConverter}, Path=V_pagos_compuestos_list_selItem.Fechainicial }"  />
                                                    <TextBlock Style="{DynamicResource TextErrorStyleTemplate}"  Text="{Binding (Validation.Errors), Converter={localConv:ValidationErrorConverter}, ConverterParameter=0, ElementName=Fechainicial}"  Margin="0,0,0,0"/>
                                                </StackPanel>

                                                <StackPanel MinWidth="110" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=1.5*x/12.5}"  Height="75"  >
                                                    <Label Style="{DynamicResource LabelFieldFormTemplate}" Margin="10,0,10,0"  Content="Fecha final" />
                                                    <DatePicker x:Name="Fechafinal" HorizontalAlignment="Left" Margin="78,10,0,0"  VerticalAlignment="Top" SelectedDate="{Binding Converter={StaticResource DateTimeOffsetToDateTimeConverter}, Path=V_pagos_compuestos_list_selItem.Fechafinal }"  />
                                                    <TextBlock Style="{DynamicResource TextErrorStyleTemplate}"  Text="{Binding (Validation.Errors), Converter={localConv:ValidationErrorConverter}, ConverterParameter=0, ElementName=Fechafinal}"  Margin="0,0,0,0"/>
                                                </StackPanel>


                                            </WrapPanel>


                                            <StackPanel MinWidth="110" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=1.5*x/12.5}"  Height="75"  >
                                                <Label Style="{DynamicResource LabelFieldFormTemplate}" Margin="10,0,10,0"  Content="Timbrados" HorizontalAlignment="Left"/>
                                                <ComboBox  x:Name="Timbrados" 
                                                               SelectedValue="{Binding V_pagos_compuestos_list_selItem.Timbrados}"
                                                               ItemsSource="{StaticResource TimbradosListString}" 
                                                               DisplayMemberPath="ValueString" 
                                                               SelectedValuePath="ValueString"/>
                                                <TextBlock Style="{DynamicResource TextErrorStyleTemplate}"  Text="{Binding (Validation.Errors), Converter={localConv:ValidationErrorConverter}, ConverterParameter=0, ElementName=Timbrados}"  Margin="0,0,0,0"/>
                                            </StackPanel>


                                            <StackPanel MinWidth="110" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=1.5*x/12.5}"  Height="75"  >
                                                <Label Style="{DynamicResource LabelFieldFormTemplate}" Margin="10,0,10,0"  Content="Solo fiscales"  HorizontalAlignment="Left" />
                                                <CheckBox x:Name="Solofiscales" IsChecked="{Binding V_pagos_compuestos_list_selItem.Solofiscales}" Margin="10,0,10,0"  HorizontalAlignment="Center"  />
                                                <TextBlock Style="{DynamicResource TextErrorStyleTemplate}"  Text="{Binding (Validation.Errors), Converter={localConv:ValidationErrorConverter}, ConverterParameter=0, ElementName=Solofiscales}"  Margin="0,0,0,0"/>
                                            </StackPanel>





                                            <StackPanel MinWidth="110" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=1.5*x/12.5}"  Height="75"  >
                                                <Label Style="{DynamicResource LabelFieldFormTemplate}" Margin="10,0,10,0"  Content="Aplicados" HorizontalAlignment="Left"/>

                                                <ComboBox  x:Name="Aplicados" 
                                                               SelectedValue="{Binding V_pagos_compuestos_list_selItem.Aplicados}"
                                                               ItemsSource="{StaticResource AplicadosListString}" 
                                                               DisplayMemberPath="ValueString" 
                                                               SelectedValuePath="ValueString"/>

                                                <TextBlock Style="{DynamicResource TextErrorStyleTemplate}"  Text="{Binding (Validation.Errors), Converter={localConv:ValidationErrorConverter}, ConverterParameter=0, ElementName=Aplicados}"  Margin="0,0,0,0"/>
                                            </StackPanel>

                                            <StackPanel MinWidth="110" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=1.5*x/12.5}"  Height="75"  >
                                                <Label Style="{DynamicResource LabelFieldFormTemplate}" Margin="10,0,10,0"  Content="Incluir cancelaciones" HorizontalAlignment="Center" />
                                                <CheckBox x:Name="Incluircancelaciones" IsChecked="{Binding V_pagos_compuestos_list_selItem.Incluircancelaciones}" Margin="10,0,10,0"  HorizontalAlignment="Center"  />
                                                <TextBlock Style="{DynamicResource TextErrorStyleTemplate}"  Text="{Binding (Validation.Errors), Converter={localConv:ValidationErrorConverter}, ConverterParameter=0, ElementName=Incluircancelaciones}"  Margin="0,0,0,0"/>
                                            </StackPanel>


                                            <WrapPanel  MinWidth="150" Width="{Binding ElementName=MainPanel, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=3*x/12.5}" Height="75"  >
                                                <Button x:Name="TSBBuscar" VerticalAlignment="Top" Width="43"  Height="30" Margin="10,10,10,0" Style="{StaticResource MaterialDesignIconButton}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <materialDesign:PackIcon Kind="FileDocumentBoxSearchOutline"/>
                                                    </StackPanel>
                                                </Button>
                                                <Button x:Name="AddItem"   VerticalAlignment="Top" Width="43"  Margin="0,10,0,0" Height="30" 
                                                        Style="{StaticResource MaterialDesignIconButton}"  Visibility="{cbind:Binding Path=AllowAdd}">
                                                    <StackPanel Orientation="Horizontal">
                                                        <materialDesign:PackIcon Kind="Add"/>
                                                    </StackPanel>
                                                </Button>
                                            </WrapPanel>


                                        </WrapPanel>
                                    </Border>
                                </StackPanel>
                            </WrapPanel>


                            <ac:AdornedControl  IsAdornerVisible="{Binding IsBusy}">
                                <ac:AdornedControl.AdornerContent>
                                    <localCont:LoadingWait></localCont:LoadingWait>
                                </ac:AdornedControl.AdornerContent>

                                <Syncfusion:SfDataGrid x:Name="PagolistGridView" 
                      ItemsSource="{Binding Items}" 
                      RowStyle="{StaticResource customCellStyle}"
                       AllowFiltering="True"
                       FilterPopupStyle="{StaticResource filterControlStyle}"
                      Margin="2,2,2,2"  AutoGenerateColumns="False" Background="#FFFFFFFF" IsReadOnly="True"  RowHeight="35" HorizontalAlignment="Left"   
                                   MinWidth="100" Width="{Binding ElementName=MainScrollViewer, Path=ActualWidth, Converter={localConv:MathConverter}, ConverterParameter=x}"
                       Height="{Binding ElementName=MainPanel, Path=ActualHeight, Converter={localConv:MathConverter}, ConverterParameter=38*x/60}" MinHeight="150"   >

                            <Syncfusion:SfDataGrid.Resources>
                                <SfExt:BindingProxy x:Key="ProxyElement" Data="{Binding}"/>
                            </Syncfusion:SfDataGrid.Resources>
                                    
                            <Syncfusion:SfDataGrid.Columns>


                                <!--<Syncfusion:GridTemplateColumn  AllowFocus="False"  Width="50" IsHidden="{cbind:Binding Source={StaticResource ProxyElement}, Path=!Data.AllowShow}">
                                    <Syncfusion:GridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Width="35" cal:Message.Attach="[Event Click]=[ShowItem($dataContext)]"  Style="{StaticResource MaterialDesignIconButton}">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="Eye"/>
                                                </StackPanel>
                                            </Button>
                                        </DataTemplate>
                                    </Syncfusion:GridTemplateColumn.CellTemplate>
                                </Syncfusion:GridTemplateColumn>

                                <Syncfusion:GridTemplateColumn  AllowFocus="False"  Width="50" IsHidden="{cbind:Binding Source={StaticResource ProxyElement}, Path=!Data.AllowEdit}">
                                    <Syncfusion:GridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Width="35" cal:Message.Attach="[Event Click]=[EditItem($dataContext)]"  
                                                    Style="{StaticResource MaterialDesignIconButton}" IsEnabled="True">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="Edit"/>
                                                </StackPanel>
                                            </Button>
                                        </DataTemplate>
                                    </Syncfusion:GridTemplateColumn.CellTemplate>
                                </Syncfusion:GridTemplateColumn>-->

                                <Syncfusion:GridTemplateColumn  AllowFocus="False"  Width="50" >
                                    <Syncfusion:GridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Width="35" cal:Message.Attach="[Event Click]=[ShowItem($dataContext)]"  Style="{StaticResource MaterialDesignIconButton}">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="Eye"/>
                                                </StackPanel>
                                            </Button>
                                        </DataTemplate>
                                    </Syncfusion:GridTemplateColumn.CellTemplate>
                                </Syncfusion:GridTemplateColumn>
                                <Syncfusion:GridTemplateColumn  AllowFocus="False" Width="50"  >
                                    <Syncfusion:GridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button Width="35"  cal:Message.Attach="[Event Click]=[Edititem($dataContext)]" Style="{StaticResource MaterialDesignIconButton}">
                                                <StackPanel Orientation="Horizontal">
                                                    <materialDesign:PackIcon Kind="Edit"/>
                                                </StackPanel>
                                            </Button>
                                        </DataTemplate>
                                    </Syncfusion:GridTemplateColumn.CellTemplate>
                                </Syncfusion:GridTemplateColumn>

                                <Syncfusion:GridTextColumn  MappingName="Fecha" HeaderText="Fecha" ColumnSizer="Auto"/>

                                <Syncfusion:GridTextColumn  MappingName="ClienteNombre" HeaderText="Cliente" ColumnSizer="Auto"/>

                                <Syncfusion:GridTextColumn  MappingName="ProveedorNombre" HeaderText="Proveedor" ColumnSizer="Auto" IsHidden="True"/>


                                <Syncfusion:GridNumericColumn  MappingName="Importe" HeaderText="Importe" ColumnSizer="Auto"
                                                                        TextAlignment="Right" NumberDecimalDigits="2" NumberDecimalSeparator="." NumberGroupSizes="3" NumberGroupSeparator=","/>

                                <Syncfusion:GridTextColumn  MappingName="Formapagonombre" HeaderText="Forma pago" ColumnSizer="Auto"/>

                                <Syncfusion:GridTextColumn  MappingName="Referenciabancaria" HeaderText="Referencia bancaria" ColumnSizer="Auto"/>

                                <Syncfusion:GridTextColumn  MappingName="Id" HeaderText="Folio" ColumnSizer="Auto"/>

                                <Syncfusion:GridTextColumn  MappingName="Banconombre" HeaderText="Banco" ColumnSizer="Auto"/>

                                <Syncfusion:GridTextColumn  MappingName="Tipopagonombre" HeaderText="Tipo pago" ColumnSizer="Auto"/>

                                <Syncfusion:GridTextColumn  MappingName="Timbrado" HeaderText="Timbrado" ColumnSizer="Auto"/>

                                <Syncfusion:GridTextColumn  MappingName="Aplicado" HeaderText="Aplicado" ColumnSizer="Auto"/>

                                    </Syncfusion:SfDataGrid.Columns>
                                </Syncfusion:SfDataGrid>

                            </ac:AdornedControl>

                        </StackPanel>



             </WrapPanel>

        </WrapPanel>
    </ScrollViewer>
</UserControl>

