CREATE OR ALTER VIEW MOVTO_POR_LOTE_VIEW(
    DOCTOID,
    PRODUCTOID,
    PRODUCTOCLAVE,
    PRODUCTONOMBRE,
    PRODUCTODESCRIPCION1,
    PRODUCTODESCRIPCION2,
    PRECIO,
    LOTES,
    TASAIVA,
    TASAIEPS,
    TASAIMPUESTO,
    DESCUENTOPORCENTAJE,
    CANTIDAD,
    FIRSTMOVTOID)
AS
SELECT MOVTO.DOCTOID , MOVTO.PRODUCTOID, PRODUCTO.CLAVE PRODUCTOCLAVE, PRODUCTO.NOMBRE PRODUCTONOMBRE,  PRODUCTO.DESCRIPCION1, PRODUCTO.descripcion2,
        MOVTO.PRECIO, LIST( MOVTO.CANTIDAD || ' - ' || COALESCE(MOVTO.LOTE,'') || ' - ' || COALESCE(MOVTO.FECHAVENCE, CURRENT_DATE)  ) LOTES  ,
            MOVTO.tasaiva,  MOVTO.tasaieps, MOVTO.tasaimpuesto , MOVTO.descuentoporcentaje, SUM(COALESCE(MOVTO.CANTIDAD, 0)) CANTIDAD , MIN(MOVTO.ID) FIRSTMOVTOID
     FROM MOVTO
      INNER JOIN PRODUCTO ON PRODUCTO.ID = MOVTO.PRODUCTOID
     GROUP BY MOVTO.DOCTOID , MOVTO.PRODUCTOID, PRODUCTO.CLAVE , PRODUCTO.NOMBRE , PRODUCTO.DESCRIPCION1, PRODUCTO.descripcion2, MOVTO.PRECIO ,MOVTO.tasaiva,  MOVTO.tasaieps, MOVTO.tasaimpuesto , MOVTO.descuentoporcentaje
;