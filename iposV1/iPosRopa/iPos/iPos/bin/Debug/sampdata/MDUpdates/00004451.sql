create or alter procedure PLAZO_HAYPLAZOSMEZCLADOS (
    DOCTOID D_FK)
returns (
    HAYPLAZOSMEZCLADOS D_BOOLCN,
    ERRORCODE D_ERRORCODE)
as
declare variable CUENTAPLAZOS integer;
declare variable PLAZOXPRODUCTO D_BOOLCN;
BEGIN

    ERRORCODE = 0;
    HAYPLAZOSMEZCLADOS = 'N';
    CUENTAPLAZOS = 0;
    PLAZOXPRODUCTO = 'N';

    SELECT PLAZOXPRODUCTO FROM PARAMETRO INTO :PLAZOXPRODUCTO;

    IF(COALESCE(:PLAZOXPRODUCTO,'N') = 'N') THEN
    BEGIN
    
        HAYPLAZOSMEZCLADOS = 'N';
        ERRORCODE = 0;
        SUSPEND;
        EXIT;
    END


     SELECT COUNT(COALESCE(PLAZO.ID,0)) FROM DOCTO
     INNER JOIN MOVTO ON DOCTO.ID = MOVTO.DOCTOID
     INNER JOIN PRODUCTO ON MOVTO.PRODUCTOID = PRODUCTO.ID
     LEFT JOIN PERSONA ON PERSONA.ID = DOCTO.PERSONAID
     LEFT JOIN PLAZO ON PLAZO.id = PRODUCTO.plazoid
     WHERE DOCTO.ID = :DOCTOID and COALESCE(PRODUCTO.PLAZOID ,0) <> 0
     AND
     (COALESCE(PERSONA.separarprodxplazo,'S') = 'S' or COALESCE(PLAZO.COMISIONISTA,'N') = 'S'  )
     --GROUP BY  COALESCE(PLAZO.ID,0)
     INTO :CUENTAPLAZOS;





    IF(COALESCE(:CUENTAPLAZOS,0) > 1 ) THEN
    BEGIN
        HAYPLAZOSMEZCLADOS = 'S';
        ERRORCODE = 0;
        SUSPEND;
        EXIT;
    END


   

   ERRORCODE = 0;
   SUSPEND;
   
  -- WHEN ANY DO
  -- BEGIN
  --   ERRORCODE = 1076;
  --   SUSPEND;
  -- END

END