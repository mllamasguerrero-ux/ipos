create or alter procedure REPLIMPOCTRL_AGREGAR (
    FUENTESUCURSALCLAVE D_CLAVE_NULL,
    FUENTEID D_FK,
    FECHAHORASYNC D_TIMESTAMP,
    TIPOID D_FK,
    DESTINOID D_FK,
    ESTATUS D_FK)
returns (
    REPLIMPOID type of D_FK,
    ERRORCODE type of D_ERRORCODE)
as
declare variable FUENTESUCURSALID type of D_FK;
BEGIN

   ERRORCODE = 0; 
        REPLIMPOID = 0;

    IF(COALESCE(:FUENTESUCURSALCLAVE,'') = '') THEN
    BEGIN
        ERRORCODE =  1000;
        SUSPEND;
        EXIT;
    END

    SELECT ID FROM SUCURSAL WHERE CLAVE = COALESCE(:FUENTESUCURSALCLAVE,'')
    INTO :FUENTESUCURSALID;

      
    IF(COALESCE(:FUENTESUCURSALID,0) = 0) THEN
    BEGIN
        ERRORCODE =  1000;
        SUSPEND;
        EXIT;
    END



      
        UPDATE OR INSERT INTO REPLIMPOCTRL
        (FUENTESUCURSALCLAVE, FUENTESUCURSALID,  FUENTEID,  FECHAHORASYNC, TIPOID, DESTINOID,  ESTATUS)
        VALUES (:FUENTESUCURSALCLAVE,  :FUENTESUCURSALID, :FUENTEID, :FECHAHORASYNC, :TIPOID ,:DESTINOID, :ESTATUS)
        MATCHING (FUENTESUCURSALID, FUENTEID, TIPOID)
        RETURNING ID INTO :REPLIMPOID;



    ERRORCODE = 0;
   SUSPEND;

   WHEN ANY DO
   BEGIN
      ERRORCODE = 1004;
      SUSPEND;
   END 

END