create or alter procedure GET_PRECIO_CONCOMISIONTARJETA (
    PRODUCTOID D_FK,
    PERSONAID D_FK,
    CANTIDAD D_CANTIDAD,
    PRECIO1 D_PRECIO,
    PRECIOPREVIO D_PRECIO,
    PAGOCONTARJETA D_BOOLCN_NULL)
returns (
    PRECIOEXPORTACIONLINEA D_PRECIO,
    ERRORCODE D_ERRORCODE)
as
declare variable PRECIOACTUAL D_PRECIO;
declare variable PRECIOBUFFER D_PRECIO;
declare variable COMISIONPORTARJETA D_PRECIO;
declare variable MULTXCOMISION D_PRECIO;
BEGIN


     PRECIOACTUAL = :PRECIOPREVIO;
     PRECIOEXPORTACIONLINEA = :PRECIOPREVIO;



     IF(COALESCE(:PAGOCONTARJETA,'N') = 'S') THEN
     BEGIN
        SELECT COMISIONPORTARJETA FROM PARAMETRO INTO :COMISIONPORTARJETA;
     END
     ELSE
     BEGIN
        COMISIONPORTARJETA = 0;
     END


     MULTXCOMISION = ((100.00 + COALESCE(:COMISIONPORTARJETA,0.00))/100.00);
     
     PRECIOACTUAL = :PRECIOPREVIO * :MULTXCOMISION;


     PRECIOEXPORTACIONLINEA = :PRECIOACTUAL ;

   ERRORCODE = 0;
   SUSPEND;

   WHEN ANY DO
   BEGIN
      ERRORCODE = 1051;
      SUSPEND;
   END 
END