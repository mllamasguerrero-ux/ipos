create or alter procedure RECEPCIONORDENCOMPRA_COPYMOVTO (
    MOVTOREFID D_FK,
    LOTE D_LOTE,
    FECHAVENCE D_FECHAVENCE,
    CANTIDADSURTIDA D_CANTIDAD,
    LOTEIMPORTADO D_FK,
    PRECIOMANUAL D_PRECIO)
returns (
    ERRORCODE D_ERRORCODE)
as
declare variable ESTATUSDOCTOID D_FK;
declare variable ALMACENID D_FK;
declare variable SUCURSALID D_FK;
declare variable PERSONAID D_FK;
declare variable TIPODOCTOCANCELARID D_FK;
declare variable TIPODOCTOID D_FK;
declare variable PRODUCTOID D_FK;
declare variable CANTIDAD D_CANTIDAD;
declare variable PRECIO D_PRECIO;
declare variable COSTO D_COSTO;
declare variable REFERENCIA D_REFERENCIA;
declare variable REFERENCIAS varchar(255);
declare variable SERIE varchar(31);
declare variable FOLIO integer;
declare variable ALMACENTID D_FK;
declare variable SUCURSALTID D_FK;
declare variable TIPODIFERENCIAINVENTARIOID D_FK;
declare variable CANTIDADDEFACTURA D_CANTIDAD;
declare variable CANTIDADDEREMISION D_CANTIDAD;
declare variable CANTIDADDEINDEFINIDO D_CANTIDAD;
declare variable NEWMOVTOID D_FK;
declare variable DOCTOID D_FK;
declare variable DESCRIPCION1 D_STDTEXT_64;
declare variable DESCRIPCION2 D_STDTEXT_64;
declare variable DESCRIPCION3 D_STDTEXT_64;
declare variable PORCENTAJEDESCUENTO D_PORCENTAJE;
BEGIN

   SELECT
       M.PRODUCTOID, /*M.CANTIDAD*/0, M.PRECIO,
       M.COSTO,
      M.TIPODIFERENCIAINVENTARIOID  , M.CANTIDADDEFACTURA, M.CANTIDADDEREMISION, M.CANTIDADDEINDEFINIDO, M.DESCRIPCION1, M.DESCRIPCION2, M.DESCRIPCION3
      ,M.TIPODOCTOID, M.DOCTOID , D.almacenid, D.sucursalid, D.PERSONAID, M.descuentoporcentaje
   FROM MOVTO M
   INNER JOIN DOCTO d on m.doctoid = d.id
   WHERE M.ID = :MOVTOREFID
   INTO
      :PRODUCTOID, :CANTIDAD, :PRECIO,
      :COSTO,
      :TIPODIFERENCIAINVENTARIOID , :CANTIDADDEFACTURA, :CANTIDADDEREMISION, :CANTIDADDEINDEFINIDO , :DESCRIPCION1, :DESCRIPCION2, :DESCRIPCION3
      ,:TIPODOCTOID, :DOCTOID  , :almacenid, :sucursalid, :PERSONAID, :PORCENTAJEDESCUENTO;



      SELECT ERRORCODE,MOVTOID
      FROM MOVTO_INSERT (
         :DOCTOID, 0, :ALMACENID, :SUCURSALID, :TIPODOCTOID, 0, 0, :PERSONAID, 0, 1,
         0, :PRODUCTOID, :LOTE, :FECHAVENCE, :CANTIDAD, :CANTIDADSURTIDA, 0, 0, 0, :PRECIO, 0,
         :REFERENCIA, :REFERENCIAS, :COSTO, :SUCURSALID, :ALMACENID, 'N',
         :TIPODIFERENCIAINVENTARIOID, CURRENT_DATE, CURRENT_DATE, :PORCENTAJEDESCUENTO ,NULL,NULL,NULL,NULL,NULL , :DESCRIPCION1, :DESCRIPCION2, :DESCRIPCION3, NULL  ,:LOTEIMPORTADO, 'N','N'
      ) INTO :ERRORCODE,:NEWMOVTOID;

      IF (:ERRORCODE <> 0) THEN
      BEGIN

         SUSPEND;
         EXIT;
      END

      UPDATE MOVTO SET PRECIOMANUAL = :PRECIOMANUAL WHERE ID = :NEWMOVTOID;

END
