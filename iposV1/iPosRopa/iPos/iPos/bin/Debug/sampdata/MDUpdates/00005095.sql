create or alter procedure KIT_AJUSTARIMPUESTOS (
    DOCTOID D_FK,
    MOVTOID D_FK,
    ESKIT D_BOOLCN)
returns (
    ERRORCODE D_ERRORCODE)
as
declare variable IVA D_PORCENTAJE;
declare variable IEPS D_PORCENTAJE;
BEGIN

   ERRORCODE = 0;


       
        IF(COALESCE(:eskit, 'N') = 'S') THEN
        BEGIN
            select SUM(COALESCE(DETALLEKITIVA,0.0)) IVA, SUM(COALESCE(DETALLEKITIEPS,0.0)) ieps FROM KIT_OBTENREFERENCIA (:DOCTOID, :MOVTOID)
            INTO :IVA, :IEPS;
            UPDATE MOVTO SET IVA = COALESCE(:IVA, 0.0), IEPS = COALESCE(:IEPS, 0.0),  IMPUESTO = COALESCE(:IVA, 0.0) + COALESCE(:IEPS, 0.0) , TOTAL = SUBTOTAL + COALESCE(:IVA, 0.0) + COALESCE(:IEPS, 0.0)  WHERE ID = :MOVTOID;
        END


   ERRORCODE = 0;
   SUSPEND;
   
   WHEN ANY DO
   BEGIN
     ERRORCODE = 1076;
     --SUSPEND;
   END
END