create or alter procedure PEDIDOS_MOVILES_LIMPIAR_REF (
    CLAVEVENDEDOR D_CLAVE)
returns (
    ERRORCODE D_ERRORCODE)
as
declare variable FECHA D_FECHA;
declare variable VENDEDORID D_FK;
BEGIN

   FECHA = dateadd (-60 day to current_date);
   ERRORCODE = 0;

   -- Si no es documento de compra 11.
   IF ((:CLAVEVENDEDOR IS NULL) OR (:CLAVEVENDEDOR = '')) THEN
   BEGIN
      ERRORCODE = 1060;
      SUSPEND;
      EXIT;
   END


   SELECT ID FROM PERSONA WHERE CLAVE = :CLAVEVENDEDOR AND TIPOPERSONAID = 20 INTO :VENDEDORID;

   IF(COALESCE(:VENDEDORID,0) = 0) THEN
   BEGIN
      ERRORCODE = 1060;
      SUSPEND;
      EXIT;
   END



   DELETE FROM MOVTO WHERE DOCTOID IN
     (SELECT ID FROM DOCTO WHERE FECHA >= :FECHA AND ESTATUSDOCTOID = 0
      AND TIPODOCTOID = 331 AND VENDEDORID = :VENDEDORID);

      
   DELETE FROM DOCTO WHERE FECHA >= :FECHA AND ESTATUSDOCTOID = 0
      AND TIPODOCTOID = 331 AND VENDEDORID = :VENDEDORID;





   IF(:ERRORCODE <> 0 ) then
   BEGIN    
      SUSPEND;
      EXIT;
   END



   SUSPEND;
   
   /*WHEN ANY DO
   BEGIN
      ERRORCODE = 1063;
      SUSPEND;
   END */
END