create or alter procedure REPL_IMPO_PAGOSCANCELSUCURSAL (
    DOCTOPAGOID D_FK,
    USERID D_FK,
    FECHA D_FECHA,
    FECHAHORA D_TIMESTAMP)
returns (
    ERRORCODE D_ERRORCODE)
as
declare variable TIPODOCTOID D_FK;
declare variable CORTEID D_FK;
declare variable SUCURSALID D_FK;
declare variable ESTATUSDOCTOENTRADAID D_FK;
declare variable ESTATUSDOCTOSALIDAID D_FK;
declare variable DOCTOID D_FK;
declare variable FORMAPAGOID D_FK;
declare variable IMPORTE D_IMPORTE;
declare variable IMPORTERECIBIDO D_IMPORTE;
declare variable IMPORTECAMBIO D_IMPORTE;
declare variable TIPOPAGOID D_FK;
declare variable DOCTOSALIDAID D_FK;
declare variable ESAPARTADO D_BOOLCN;
declare variable TIPOAPLICACIONCREDITOID D_FK;
declare variable BANCOCLAVE D_CLAVE_NULL;
declare variable REFERENCIABANCARIA D_STDTEXT_LIGHT;
declare variable NOTAS D_STDTEXT_MEDIUM;
declare variable FECHAELABORACION D_FECHA;
declare variable FECHARECEPCION D_FECHA;
declare variable ESPAGOINICIAL D_BOOLCN;
declare variable TIPOABONOID D_FK;
declare variable FORMAPAGOSATID D_FK;
declare variable COMISION D_IMPORTE;
declare variable CUENTAPAGOCREDITO D_STDTEXT_LIGHT;
declare variable APLICADO D_BOOLCN_NULL;
declare variable FECHAAPLICADO D_FECHA;
declare variable SUCURSALFUENTE D_CLAVE_NULL;
declare variable BANCO D_FK;
BEGIN

    SELECT PARAMETRO.SUCURSALID FROM PARAMETRO INTO :SUCURSALID;

    
   
   SELECT ID FROM CORTE WHERE CAJEROID = :USERID AND FECHACORTE = :FECHA INTO :CORTEID;

   IF(COALESCE(:CORTEID , 0) = 0) THEN
   BEGIN
       SELECT ERRORCODE,  CORTEID FROM
        CORTE_ABRIR (
                :FECHA,
                :SUCURSALID ,
                :USERID ,
                0,
            1) INTO :ERRORCODE, :CORTEID;

            
        IF (:ERRORCODE > 0) THEN
        BEGIN
            SUSPEND;
            EXIT;
        END
   END





   IF(COALESCE(:DOCTOID,0) <> 0) THEN
   BEGIN

       SELECT ESTATUSDOCTOID FROM DOCTO WHERE ID = :DOCTOID INTO :ESTATUSDOCTOENTRADAID;

      IF(COALESCE(:ESTATUSDOCTOENTRADAID,0) <> 1) THEN
      BEGIN
            ERRORCODE = 0;
            SUSPEND;
            EXIT;
      END
   END


   
   IF(COALESCE(:DOCTOSALIDAID,0) <> 0) THEN
   BEGIN

       SELECT ESTATUSDOCTOID FROM DOCTO WHERE ID = :DOCTOSALIDAID INTO :ESTATUSDOCTOSALIDAID;

      IF(COALESCE(:ESTATUSDOCTOSALIDAID,0) <> 1) THEN
      BEGIN
            ERRORCODE = 0;
            SUSPEND;
            EXIT;
      END
   END

   SELECT 
     DOCTOID,
     FORMAPAGOID,
     IMPORTE * -1,
     IMPORTERECIBIDO * -1,
     IMPORTECAMBIO * -1,
     TIPOPAGOID,
     DOCTOSALIDAID,
     ESAPARTADO,
     TIPOAPLICACIONCREDITOID,
     BANCO,
     REFERENCIABANCARIA,
     NOTAS,
     FECHAELABORACION,
     FECHARECEPCION,
     ESPAGOINICIAL,
     3,
     FORMAPAGOSATID,
     COMISION,
     CUENTAPAGOCREDITO,
     APLICADO,
     FECHAAPLICADO
     FROM DOCTOPAGO WHERE ID = :DOCTOPAGOID
     INTO 
     :DOCTOID,
     :FORMAPAGOID,
     :IMPORTE ,
     :IMPORTERECIBIDO,
     :IMPORTECAMBIO,
     :TIPOPAGOID,
     :DOCTOSALIDAID,
     :ESAPARTADO,
     :TIPOAPLICACIONCREDITOID,
     :BANCO,
     :REFERENCIABANCARIA,
     :NOTAS,
     :FECHAELABORACION,
     :FECHARECEPCION,
     :ESPAGOINICIAL,
     :TIPOABONOID,
     :FORMAPAGOSATID,
     :COMISION,
     :CUENTAPAGOCREDITO,
     :APLICADO,
     :FECHAAPLICADO;






   SELECT DOCTOPAGOID, ERRORCODE FROM DOCTOPAGO_INSERT (
    :DOCTOID ,
    :FORMAPAGOID ,
    :FECHA ,
    :FECHAHORA ,
    :CORTEID ,
    :IMPORTE ,
    :IMPORTERECIBIDO ,
    :IMPORTECAMBIO ,
    :TIPOPAGOID ,
    :DOCTOSALIDAID ,
    :ESAPARTADO ,
    :TIPOAPLICACIONCREDITOID ,
    :BANCO ,
    :REFERENCIABANCARIA ,
    :NOTAS ,
    :FECHAELABORACION ,
    :FECHARECEPCION ,
    :ESPAGOINICIAL ,
    :TIPOABONOID ,
    :DOCTOPAGOID,--DOCTOPAGOREFID ,
    :FORMAPAGOSATID ,
    NULL,--BANCOMERPARAMID ,
    :COMISION ,
    :CUENTAPAGOCREDITO ,
    NULL,--CUENTABANCOEMPRESAID ,
    :APLICADO ,
    :FECHAAPLICADO ,
    NULL, --PAGOID,
    NULL ,
    NULL
    )
    INTO :DOCTOPAGOID, :ERRORCODE;

     
    IF (:ERRORCODE > 0) THEN
    BEGIN
            SUSPEND;
            EXIT;
    END


   
   ERRORCODE = 0;
   SUSPEND;
   
   WHEN ANY DO
   BEGIN
      ERRORCODE = 1012;
      SUSPEND;
   END
END