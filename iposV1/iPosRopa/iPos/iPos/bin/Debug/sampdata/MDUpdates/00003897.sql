create or alter procedure GUIADETALLE_DELETE (
    GUIADETALLEID D_FK,
    CAJEROID D_FK)
returns (
    ERRORCODE type of D_ERRORCODE)
as
declare variable DOCTOID D_FK;
declare variable GUIAID D_FK;
BEGIN
  ERRORCODE = 0;

  -- FALTA COMPLETAR

  SELECT DOCTOID, GUIAID FROM GUIADETALLE WHERE ID = :GUIADETALLEID INTO :DOCTOID, :GUIAID;

  IF(COALESCE(:DOCTOID,0) = 0  ) THEN
  BEGIN
    SUSPEND;
    EXIT;
  END
  
   UPDATE DOCTO SET ESTADOGUIAID = 0, GUIAID = NULL
    WHERE ID = :DOCTOID AND GUIAID = :GUIAID;
  
   DELETE FROM  GUIADETALLE
  WHERE ID = :GUIADETALLEID;


          
  SELECT ERRORCODE FROM GUIADETALLE_ACTUALIZARESTADO(:GUIAID, :CAJEROID) INTO :ERRORCODE;

            
  IF(COALESCE(:ERRORCODE,0) <> 0  ) THEN
  BEGIN
    SUSPEND;
    EXIT;
  END



   ERRORCODE = 0;
   SUSPEND;
END