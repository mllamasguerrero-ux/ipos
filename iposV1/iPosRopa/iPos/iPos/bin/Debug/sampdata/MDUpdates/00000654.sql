CREATE OR ALTER TRIGGER MOVTO_AU_1 FOR MOVTO
ACTIVE AFTER UPDATE POSITION 10
AS
   DECLARE VARIABLE ERRORCODE D_ERRORCODE;
BEGIN
    IF (NOT ((NEW.TOTAL IS NULL) OR (NEW.TOTAL = 0))) THEN
    BEGIN
        SELECT ERRORCODE
        FROM DOCTO_ACUMULAR_TOTALES (
           NEW.DOCTOID,
           NEW.IMPORTE - OLD.IMPORTE,
           NEW.SUBTOTAL - OLD.SUBTOTAL,
           NEW.IVA - OLD.IVA,
           NEW.TOTAL - OLD.TOTAL ,
           COALESCE(NEW.MONEDEROABONO,0) - COALESCE(OLD.MONEDEROABONO,0)
        ) INTO :ERRORCODE;
    END
END