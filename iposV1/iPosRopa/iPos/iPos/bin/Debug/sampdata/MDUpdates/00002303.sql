create or alter procedure KIT_DEFINICIONINSERT (
    ACTIVO D_BOOLCS,
    PRODUCTOKITID D_FK,
    PRODUCTOPARTEID D_FK,
    CANTIDADPARTE D_CANTIDAD,
    PRODUCTOKITCLAVE D_CLAVE_NULL,
    PRODUCTOPARTECLAVE D_CLAVE_NULL,
    COSTOPARTE D_PRECIO

)
returns (
    KITDEFINICIONID type of D_FK,
    ERRORCODE type of D_ERRORCODE)
as
declare variable KITESINVENTARIABLE D_BOOLCN;
declare variable PARTEESINVENTARIABLE D_BOOLCN;
declare variable PARTEESPRODUCTOPADRE D_BOOLCN;
BEGIN
           
   ERRORCODE = 0;

   SELECT FIRST 1 PRODUCTO.inventariable FROM PRODUCTO WHERE ID = :PRODUCTOKITID INTO :KITESINVENTARIABLE;
   SELECT FIRST 1 PRODUCTO.inventariable, PRODUCTO.esproductopadre FROM PRODUCTO WHERE ID = :PRODUCTOPARTEID INTO :PARTEESINVENTARIABLE, :PARTEESPRODUCTOPADRE;


   IF(COALESCE(:PARTEESPRODUCTOPADRE,'N') = 'S') THEN
   BEGIN   
            ERRORCODE = 4012;
            SUSPEND;
            EXIT;
   END

   
   IF(COALESCE(:KITESINVENTARIABLE,'N') <> 'S' AND COALESCE(:PARTEESINVENTARIABLE,'N') = 'S'  )  THEN
   BEGIN   
            ERRORCODE = 4011;
            SUSPEND;
            EXIT;
   END


   INSERT INTO KITDEFINICION
      (
        ACTIVO,
        PRODUCTOKITID,
        PRODUCTOPARTEID,
        CANTIDADPARTE,
        PRODUCTOKITCLAVE,
        PRODUCTOPARTECLAVE,
        COSTOPARTE
      )

    Values (

        :ACTIVO,
        :PRODUCTOKITID,
        :PRODUCTOPARTEID,
        :CANTIDADPARTE,
        :PRODUCTOKITCLAVE,
        :PRODUCTOPARTECLAVE,
        :COSTOPARTE
    )
    RETURNING ID INTO :KITDEFINICIONID;



   IF ((:KITDEFINICIONID IS NULL) OR (:KITDEFINICIONID = 0)) THEN
   BEGIN
      ERRORCODE = 4008;
   END

   SUSPEND;
END