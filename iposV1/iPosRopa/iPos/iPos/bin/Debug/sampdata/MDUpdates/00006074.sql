create or alter procedure CORTE_ULTIMOFONDODINAMICO (
    CAJEROID D_FK,
    FECHACORTE D_FECHA)
returns (
    FONDODINAMICO D_IMPORTE,
    ERRORCODE D_ERRORCODE)
as
DECLARE VARIABLE CORTEIDACTUAL D_FK;
BEGIN

        select FIRST 1 ID from CORTE
        where fechacorte = :FECHACORTE and cajeroid = :CAJEROID
        order by id desc
        INTO  :CORTEIDACTUAL;
        
      SELECT FIRST 1 FONDODINAMICOFINAL
      FROM CORTE
      WHERE CAJEROID = :CAJEROID AND COALESCE(:CORTEIDACTUAL,0) <> ID
      ORDER BY TERMINA DESC
      INTO :FONDODINAMICO;
      
   ERRORCODE = 0;
   SUSPEND;

   WHEN ANY DO
   BEGIN
      ERRORCODE = 1019;
      SUSPEND;
   END 
END