create or alter procedure CONSOLIDADO_PORCONSOLIDARSUMA (
    FECHAINICIAL D_FECHA,
    FECHAFINAL D_FECHA,
    OMITIRVENTASAFRANQUICIAS varchar(2),
    INCLUIRGASTOS D_BOOLCN_NULL,
    MAXIMOMONTO D_PRECIO,
    OMITIRVALES D_BOOLCN_NULL,
    SUMACOMPLETAVENTAS D_BOOLCN_NULL)
returns (
    CUENTAREGISTROS integer,
    SUMAIMPORTE D_PRECIO,
    SUMADESCUENTO D_PRECIO,
    SUMASUBTOTAL D_PRECIO,
    SUMAIVA D_PRECIO,
    SUMAIEPS D_PRECIO,
    SUMAIMPUESTO D_PRECIO,
    SUMATOTAL D_PRECIO,
    SUMASALDO D_PRECIO,
    SUMAABONO D_PRECIO,
    SUMACARGO D_PRECIO,
    MINFOLIO D_DOCTOFOLIO,
    MAXFOLIO D_DOCTOFOLIO,
    SUMAIVARETENIDO D_PRECIO,
    SUMAISRRETENIDO D_PRECIO)
as
declare variable NUMERO integer;
BEGIN
   NUMERO = 0;


   SELECT
   COUNT(*) AS  CUENTAREGISTROS,
   SUM(TOTAL )  AS SUMATOTAL,
   SUM(SUBTOTAL )  AS SUMASUBTOTAL,
   SUM(IVA ) AS SUMAIVA,
   SUM(IEPS ) AS SUMAIEPS,
   SUM(IMPUESTO ) AS SUMAIMPUESTO,
   SUM(SALDO) AS SUMASALDO,
   SUM(ABONO ) AS SUMAABONO,
   SUM(CARGO ) AS SUMACARGO,
   SUM(IMPORTE ) AS SUMAIMPORTE,
   SUM(DESCUENTO )  AS SUMADESCUENTO , 
   SUM(IVARETENIDO ) AS SUMAIVARETENIDO,
   SUM(ISRRETENIDO ) AS SUMAISRRETENIDO,
   MIN(CASE WHEN TIPODOCTOID = 21 THEN FOLIO ELSE 99999999 end) MINFOLIO,
   MAX(CASE WHEN TIPODOCTOID = 21 THEN FOLIO ELSE 0 end) MAXFOLIO
   FROM
  CONSOLIDADO_PORCONSOLIDAR(:FECHAINICIAL, :FECHAFINAL, :OMITIRVENTASAFRANQUICIAS, :INCLUIRGASTOS, :MAXIMOMONTO, :OMITIRVALES, :SUMACOMPLETAVENTAS)
    WHERE COALESCE(APLICADO,'S') = 'S'
   INTO
    :CUENTAREGISTROS,
    :SUMATOTAL,
    :SUMASUBTOTAL,
    :SUMAIVA,
    :SUMAIEPS,
    :SUMAIMPUESTO,
    :SUMASALDO,
    :SUMAABONO,
    :SUMACARGO,
    :SUMAIMPORTE,
    :SUMADESCUENTO,
    :SUMAIVARETENIDO,
    :SUMAISRRETENIDO,
    :MINFOLIO,
    :MAXFOLIO ;


      if (COALESCE(:CUENTAREGISTROS,0) = 0) then
   begin
    CUENTAREGISTROS = 0;
    SUMAIMPORTE = 0.0;
    SUMADESCUENTO = 0.0;
    SUMASUBTOTAL = 0.0;
    SUMAIVA = 0.0;
    SUMAIEPS  = 0.0;
    SUMAIMPUESTO  = 0.0;
    SUMATOTAL  = 0.0;
    SUMASALDO  = 0.0;
    SUMAABONO  = 0.0;
    SUMACARGO  = 0.0; 
    SUMAIVARETENIDO = 0.0;
    SUMAISRRETENIDO = 0.0;
    MINFOLIO = 0.0;
    MAXFOLIO = 0.0;
   end

   SUSPEND;

END