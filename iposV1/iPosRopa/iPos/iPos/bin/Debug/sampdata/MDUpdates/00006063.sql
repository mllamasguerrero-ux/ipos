create or alter procedure CORTE_TOTALES (
    SUCURSALID D_FK,
    CAJEROID D_FK)
returns (
    CORTEID D_FK,
    FECHACORTE D_FECHA,
    SALDOINICIAL D_IMPORTE,
    INGRESO D_IMPORTE,
    EGRESO D_IMPORTE,
    DEVOLUCION D_IMPORTE,
    SALDOFINAL D_IMPORTE,
    APORTACION D_IMPORTE,
    RETIRO D_IMPORTE,
    INGRESOTARJETA D_IMPORTE,
    INGRESOEFECTIVO D_IMPORTE,
    INGRESOCREDITO D_IMPORTE,
    INGRESOCHEQUE D_IMPORTE,
    INGRESOVALE D_IMPORTE,
    CAMBIOCHEQUE D_IMPORTE,
    SALDOREAL D_IMPORTE,
    PAGOPROVEEDORES D_IMPORTE,
    EGRESOTARJETA D_IMPORTE,
    EGRESOEFECTIVO D_IMPORTE,
    EGRESOCREDITO D_IMPORTE,
    EGRESOCHEQUE D_IMPORTE,
    EGRESOVALE D_IMPORTE,
    SALDOREALCREDITO D_IMPORTE,
    INGRESOMONEDERO D_IMPORTE,
    EGRESOMONEDERO D_IMPORTE,
    INGRESOTRANSFERENCIA D_IMPORTE,
    EGRESOTRANSFERENCIA D_IMPORTE,
    INGRESOINDEFINIDO D_IMPORTE,
    EGRESOINDEFINIDO D_IMPORTE,
    INGRESOTARJETAVENTATRASLADO D_IMPORTE,
    INGRESOEFECTIVOVENTATRASLADO D_IMPORTE,
    INGRESOCREDITOVENTATRASLADO D_IMPORTE,
    INGRESOVALEVENTATRASLADO D_IMPORTE,
    INGRESOCHEQUEVENTATRASLADO D_IMPORTE,
    INGRESOMONEDEROVENTATRASLADO D_IMPORTE,
    INGRESOTRANSFVENTATRASLADO D_IMPORTE,
    EGRESOEFEVENTATRASLADO D_IMPORTE,
    INGRESODEPOSITO D_IMPORTE,
    EGRESODEPOSITO D_IMPORTE,
    INGRESODEPOSITOVENTATRASLADO D_IMPORTE,
    INGRESODEPTERCERO D_IMPORTE,
    EGRESODEPTERCERO D_IMPORTE,
    INGRESODEPTERCEROVENTATRASLADO D_IMPORTE,
    INGRESOINDEFVENTATRASLADO D_IMPORTE,
    FONDEOSDECAJA D_IMPORTE,
    RETIROSDECAJA D_IMPORTE,
    FONDODINAMICO D_IMPORTE,
    FONDODINAMICOFINAL D_IMPORTE,
    ERRORCODE D_ERRORCODE)
as
declare variable ACTIVO D_BOOLCN;
declare variable TICKETSVENTA integer;
declare variable TICKETSDEVOLUCION integer;
declare variable INGRESOPORIVA D_IMPORTE;
declare variable INGRESOSUBTOTAL D_IMPORTE;
declare variable INGRESODESCUENTO D_IMPORTE;
declare variable INGRESOIMPORTE D_IMPORTE;
declare variable TOTALAFECTACION D_IMPORTE;
declare variable SUBTOTALSINIVA D_IMPORTE;
declare variable SUBTOTALCONIVA D_IMPORTE;
declare variable MONTOIVA D_IMPORTE;
declare variable MONTOIEPS D_IMPORTE;
declare variable MONTOIMPUESTO D_IMPORTE;
declare variable MANEJAIEPS D_BOOLCN;
declare variable DEVOLUCIONEFECTIVO D_IMPORTE;
declare variable DEVOLUCIONCREDITO D_IMPORTE;
declare variable DEVOLUCIONTARJETA D_IMPORTE;
declare variable DEVOLUCIONCHEQUE D_IMPORTE;
declare variable DEVOLUCIONVALE D_IMPORTE;
declare variable DEVOLUCIONMONEDERO D_IMPORTE;
declare variable DEVOLUCIONTRANSFERENCIA D_IMPORTE;
declare variable DEVOLUCIONINDEFINIDO D_IMPORTE;
BEGIN


   FONDEOSDECAJA = 0;
   RETIROSDECAJA = 0;

   SELECT CORTEID
   FROM PERSONA
   WHERE ID = :CAJEROID
   INTO :CORTEID ;

        
   IF (:CORTEID IS NULL) THEN
   BEGIN
      ERRORCODE = 1020;
      SUSPEND;
      EXIT;
   END

   SELECT 
    FECHACORTE ,
    SALDOINICIAL ,
    INGRESO ,
    EGRESO ,
    DEVOLUCION ,
    SALDOFINAL ,
    APORTACION ,
    RETIRO ,
    INGRESOTARJETA ,
    INGRESOEFECTIVO ,
    INGRESOCREDITO ,
    INGRESOCHEQUE ,
    INGRESOVALE ,
    CAMBIOCHEQUE ,
    SALDOREAL ,
    PAGOPROVEEDORES ,
    EGRESOTARJETA ,
    EGRESOEFECTIVO ,
    EGRESOCREDITO ,
    EGRESOCHEQUE ,
    EGRESOVALE ,
    SALDOREALCREDITO ,
    INGRESOMONEDERO ,
    EGRESOMONEDERO ,
    INGRESOTRANSFERENCIA ,
    EGRESOTRANSFERENCIA ,
    INGRESOINDEFINIDO ,
    EGRESOINDEFINIDO ,
    INGRESOTARJETAVENTATRASLADO,
    INGRESOEFECTIVOVENTATRASLADO ,
    INGRESOCREDITOVENTATRASLADO  ,
    INGRESOVALEVENTATRASLADO   ,
    INGRESOCHEQUEVENTATRASLADO ,
    INGRESOMONEDEROVENTATRASLADO ,
    INGRESOTRANSFVENTATRASLADO  ,
     EGRESOEFEVENTATRASLADO,
    INGRESODEPOSITO ,
    EGRESODEPOSITO ,
    INGRESODEPOSITOVENTATRASLADO ,
    INGRESODEPTERCERO ,
    EGRESODEPTERCERO ,
    INGRESODEPTERCEROVENTATRASLADO ,
    INGRESOINDEFVENTATRASLADO,
    ERRORCODE 
    FROM CORTE_TOTALES_PORID(:CORTEID)
    INTO 
    :FECHACORTE ,
    :SALDOINICIAL ,
    :INGRESO ,
    :EGRESO ,
    :DEVOLUCION ,
    :SALDOFINAL ,
    :APORTACION ,
    :RETIRO ,
    :INGRESOTARJETA ,
    :INGRESOEFECTIVO ,
    :INGRESOCREDITO ,
    :INGRESOCHEQUE ,
    :INGRESOVALE ,
    :CAMBIOCHEQUE ,
    :SALDOREAL ,
    :PAGOPROVEEDORES ,
    :EGRESOTARJETA ,
    :EGRESOEFECTIVO ,
    :EGRESOCREDITO ,
    :EGRESOCHEQUE ,
    :EGRESOVALE ,
    :SALDOREALCREDITO ,
    :INGRESOMONEDERO ,
    :EGRESOMONEDERO ,
    :INGRESOTRANSFERENCIA ,
    :EGRESOTRANSFERENCIA ,
    :INGRESOINDEFINIDO ,
    :EGRESOINDEFINIDO , 
    :INGRESOTARJETAVENTATRASLADO,
    :INGRESOEFECTIVOVENTATRASLADO ,
    :INGRESOCREDITOVENTATRASLADO  ,
    :INGRESOVALEVENTATRASLADO   ,
    :INGRESOCHEQUEVENTATRASLADO ,
    :INGRESOMONEDEROVENTATRASLADO ,
    :INGRESOTRANSFVENTATRASLADO  ,
    :EGRESOEFEVENTATRASLADO,
    :INGRESODEPOSITO ,
    :EGRESODEPOSITO ,
    :INGRESODEPOSITOVENTATRASLADO ,
    :INGRESODEPTERCERO ,
    :EGRESODEPTERCERO ,
    :INGRESODEPTERCEROVENTATRASLADO ,
    :INGRESOINDEFVENTATRASLADO,
    :ERRORCODE ;

    IF(COALESCE(:ERRORCODE,0) <> 0 ) THEN
    BEGIN

      SUSPEND;
      EXIT;
    END

    
      SELECT FONDEOSDECAJA, RETIROSDECAJA, FONDODINAMICO, FONDODINAMICOFINAL
      FROM CORTE WHERE ID = :CORTEID
      INTO :FONDEOSDECAJA, :RETIROSDECAJA, :FONDODINAMICO, :FONDODINAMICOFINAL;







   WHEN ANY DO
   BEGIN
      ERRORCODE = 1022;
      SUSPEND;
   END
END