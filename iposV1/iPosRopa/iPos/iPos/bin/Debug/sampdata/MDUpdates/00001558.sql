create or alter procedure GET_PRECIOMINIMO (
    PRODUCTOID D_FK,
    PERSONAID D_FK)
returns (
    PRECIOMINIMO integer)
as
declare variable LPMNUM integer;
declare variable SUPERLISTAPRECIOID D_FK;
declare variable MANEJASUPERLISTAPRECIO D_BOOLCN;
BEGIN

 SELECT MANEJASUPERLISTAPRECIO FROM PARAMETRO INTO :MANEJASUPERLISTAPRECIO;
 SELECT SUPERLISTAPRECIOID FROM persona WHERE ID = :PERSONAID INTO :SUPERLISTAPRECIOID;

 IF(COALESCE(:MANEJASUPERLISTAPRECIO ,'N') = 'N') THEN
 BEGIN
    SUPERLISTAPRECIOID = 1;
 END


    -- Tomar cual es el campo precio minimo de la tabla de parametros IPOSTYPE
   SELECT LISTAPRECIOMINIMO
   FROM IPOSTYPE I
   WHERE I.ID = (
      SELECT IPOS_TYPE FROM PARAMETRO
   )
   INTO :LPMNUM;

    -- Elegir el precio minimo de los campos PRECIO(x)
   IF (:LPMNUM = 1) THEN
      SELECT CASE WHEN :SUPERLISTAPRECIOID = 2 THEN SPRECIO1 ELSE PRECIO1 END FROM PRODUCTO WHERE ID = :PRODUCTOID INTO :PRECIOMINIMO;
   ELSE IF (:LPMNUM = 2) THEN
      SELECT CASE WHEN :SUPERLISTAPRECIOID = 2 THEN SPRECIO2 ELSE PRECIO2 END FROM PRODUCTO WHERE ID = :PRODUCTOID INTO :PRECIOMINIMO;
   ELSE IF (:LPMNUM = 3) THEN
      SELECT CASE WHEN :SUPERLISTAPRECIOID = 2 THEN SPRECIO3 ELSE PRECIO3 END FROM PRODUCTO WHERE ID = :PRODUCTOID INTO :PRECIOMINIMO;
   ELSE IF (:LPMNUM = 4) THEN
      SELECT CASE WHEN :SUPERLISTAPRECIOID = 2 THEN SPRECIO4 ELSE PRECIO4 END FROM PRODUCTO WHERE ID = :PRODUCTOID INTO :PRECIOMINIMO;
   ELSE IF (:LPMNUM = 5) THEN
      SELECT CASE WHEN :SUPERLISTAPRECIOID = 2 THEN SPRECIO5 ELSE PRECIO5 END FROM PRODUCTO WHERE ID = :PRODUCTOID INTO :PRECIOMINIMO;
   ELSE
      SELECT CASE WHEN :SUPERLISTAPRECIOID = 2 THEN SPRECIO1 ELSE PRECIO1 END FROM PRODUCTO WHERE ID = :PRODUCTOID INTO :PRECIOMINIMO;

   SUSPEND;
END