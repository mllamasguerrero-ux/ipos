create or alter procedure REPORTE_VENTA_PRODUCTO (
    FECHAINI D_FECHA,
    FECHAFIN D_FECHA,
    CAJAID D_FK,
    TURNOID D_FK)
returns (
    FECHA D_FECHA,
    PRODUCTOID D_FK,
    PRODUCTOCLAVE varchar(31),
    PRODUCTONOMBRE varchar(129),
    PRODUCTODESCRIPCION1 varchar(129),
    PRODUCTODESCRIPCION2 varchar(129),
    CANTIDAD D_CANTIDAD,
    SUBTOTAL D_IMPORTE,
    IVA D_IMPORTE,
    TOTAL D_IMPORTE,
    IEPS D_IMPORTE,
    IMPUESTO D_IMPORTE)
as
BEGIN
   FOR
   SELECT
      D.FECHA,
      M.PRODUCTOID,
      P.CLAVE,
      P.NOMBRE,
      P.DESCRIPCION1,
      P.DESCRIPCION2,
      SUM(M.CANTIDAD),
      SUM(M.SUBTOTAL),
      SUM(M.IVA),
      SUM(M.TOTAL),
      SUM(M.IEPS),
      SUM(M.IMPUESTO)
   FROM MOVTO M
     LEFT JOIN DOCTO D
       ON D.ID = M.DOCTOID
     LEFT JOIN PRODUCTO P
       ON P.ID = M.PRODUCTOID
   WHERE D.FECHA BETWEEN :FECHAINI AND :FECHAFIN
      AND ((:CAJAID = 0) OR (D.CAJAID = :CAJAID))
      AND ((:TURNOID = 0) OR (D.TURNOID = :TURNOID))
   GROUP BY
      D.FECHA,
      M.PRODUCTOID,
      P.CLAVE,
      P.NOMBRE,
      P.DESCRIPCION1,
      P.DESCRIPCION2
   ORDER BY
      D.FECHA,
      M.PRODUCTOID,
      P.CLAVE,
      P.NOMBRE,
      P.DESCRIPCION1,
      P.DESCRIPCION2
   INTO
      :FECHA,
      :PRODUCTOID,
      :PRODUCTOCLAVE,
      :PRODUCTONOMBRE,
      :PRODUCTODESCRIPCION1,
      :PRODUCTODESCRIPCION2,
      :CANTIDAD,
      :SUBTOTAL,
      :IVA,
      :TOTAL ,
      :IEPS,
      :IMPUESTO
   DO
   BEGIN
      SUSPEND;
   END

   WHEN ANY DO
   BEGIN
      SUSPEND;
   END

END