create or alter procedure INVFIS_UNICOLOTE_APLICARENTRADA (
    DOCTOREFERENCIAID D_FK)
returns (
    ERRORCODE D_ERRORCODE)
as
declare variable DOCTOIDENTRADA D_FK;
declare variable FECHAREFERENCIA D_FECHA;
BEGIN

   ERRORCODE = 0;


               
   SELECT FECHA FROM DOCTO WHERE ID = :DOCTOREFERENCIAID INTO :FECHAREFERENCIA;


   FOR
       SELECT ID FROM DOCTO
       WHERE FECHA = :FECHAREFERENCIA AND DOCTOREFID = :DOCTOREFERENCIAID
        AND SUBTIPODOCTOID = 19
        INTO :DOCTOIDENTRADA
   DO
   BEGIN

        SELECT ERRORCODE FROM  INVFIS_DIF_APLICAR (:DOCTOIDENTRADA, NULL)  INTO :ERRORCODE;
         
        IF ((:ERRORCODE IS NOT NULL) AND (:ERRORCODE > 0)) THEN
        BEGIN
         SUSPEND;
         EXIT;
        END


    END




   
   ERRORCODE = 0;
   SUSPEND;

   
  /* WHEN ANY DO
   BEGIN
     ERRORCODE = 1076;
     SUSPEND;
   END  */

   END