CREATE OR ALTER TRIGGER DOCTO_BU5 FOR DOCTO
ACTIVE BEFORE UPDATE POSITION 5
AS
begin
  /* Trigger text */
  
    IF ((OLD.ESTATUSDOCTOID = 0) AND (NEW.ESTATUSDOCTOID = 1) ) THEN
    BEGIN
           
       SELECT
       SUM(CASE WHEN COALESCE(IVA,0) = 0 THEN COALESCE(SUBTOTAL,0) ELSE 0 END) SUBTOTALSINIVA  ,
       SUM(CASE WHEN COALESCE(IVA,0) <> 0 THEN COALESCE(SUBTOTAL,0) ELSE 0 END) SUBTOTALCONIVA
       FROM MOVTO WHERE DOCTOID = NEW.ID
       INTO NEW.SUBTOTALSINIVA, NEW.SUBTOTALCONIVA;

    END
end