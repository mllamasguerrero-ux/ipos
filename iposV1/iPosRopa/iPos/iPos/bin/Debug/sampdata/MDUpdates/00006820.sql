create or alter procedure PROMOCION_IMPORTAR (
    CLAVE D_CLAVE,
    NOMBRE D_NOMBRE,
    DESCRIPCION D_DESCRIPCION,
    SUCURSALCLAVE D_CLAVE_NULL,
    CANTIDAD D_CANTIDAD,
    PRODUCTOCLAVE D_CLAVE_NULL,
    UTILIDAD D_PRECIO,
    CANTIDADLLEVATE D_CANTIDAD,
    IMPORTE D_PRECIO,
    PORCENTAJEDESCUENTO D_PORCENTAJE,
    TIPOPROMOCIONCLAVE D_CLAVE_NULL,
    RANGOPROMOCIONCLAVE D_CLAVE_NULL,
    LINEACLAVE D_CLAVE_NULL,
    FECHAINICIO D_FECHA,
    FECHAFIN D_FECHA,
    LUNES D_BOOLCN,
    MARTES D_BOOLCN,
    MIERCOLES D_BOOLCN,
    JUEVES D_BOOLCN,
    VIERNES D_BOOLCN,
    SABADO D_BOOLCN,
    DOMINGO D_BOOLCN,
    PORIMPORTE D_PRECIO,
    ENMONEDERO D_BOOLCN,
    ACTIVO D_BOOLCS,
    ESMULTIDETALLE d_boolcn,
    DESCMULTIDETALLE d_descripcion)
returns (
    ERRORCODE D_ERRORCODE)
as
declare variable SUCURSALID D_FK;
declare variable PRODUCTOID D_FK;
declare variable TIPOPROMOCIONID D_FK;
declare variable RANGOPROMOCIONID D_FK;
declare variable LINEAID D_FK;
declare variable PROMOCIONID D_FK;
begin
  /* Procedure Text */

  ERRORCODE = 0;


  
  select min(id)  from SUCURSAL
   where  clave = :SUCURSALCLAVE
  into :SUCURSALID;

  
  select min(id)  from PRODUCTO
   where  clave = :PRODUCTOCLAVE
  into :PRODUCTOID;

  select min(id)  from TIPOPROMOCION
   where  clave = :TIPOPROMOCIONCLAVE
  into :TIPOPROMOCIONID;

  select min(id)  from RANGOPROMOCION
   where  clave = :RANGOPROMOCIONCLAVE
  into :RANGOPROMOCIONID;

  select min(id) lineaID from linea 
   where  clave = :LINEACLAVE
  into :LINEAID;



  SELECT ID FROM PROMOCION WHERE CLAVE = :CLAVE INTO :PROMOCIONID;

    --INSERCION
  IF(COALESCE(:PROMOCIONID,0) = 0) THEN
  BEGIN
      INSERT INTO promocion
      (CLAVE,
NOMBRE,
DESCRIPCION,
SUCURSALID,
CANTIDAD,
PRODUCTOID,
UTILIDAD,
CANTIDADLLEVATE,
IMPORTE,
PORCENTAJEDESCUENTO,
TIPOPROMOCIONID,
RANGOPROMOCIONID,
LINEAID,
FECHAINICIO,
FECHAFIN,
LUNES,
MARTES,
MIERCOLES,
JUEVES,
VIERNES,
SABADO,
DOMINGO,
PORIMPORTE,
ENMONEDERO,
ACTIVO ,
ESMULTIDETALLE,
DESCMULTIDETALLE

)
    VALUES (
    :CLAVE,
    :NOMBRE,
    :DESCRIPCION,
    :SUCURSALID,
    :CANTIDAD,
    :PRODUCTOID,
    :UTILIDAD,
    :CANTIDADLLEVATE,
    :IMPORTE,
    :PORCENTAJEDESCUENTO,
    :TIPOPROMOCIONID,
    :RANGOPROMOCIONID,
    :LINEAID,
    :FECHAINICIO,
    :FECHAFIN,
    :LUNES,
    :MARTES,
    :MIERCOLES,
    :JUEVES,
    :VIERNES,
    :SABADO,
    :DOMINGO,
    :PORIMPORTE,
    :ENMONEDERO ,
    :ACTIVO   ,
    :ESMULTIDETALLE,
    :DESCMULTIDETALLE
);

  END
  ELSE --UPDATE
  BEGIN
    UPDATE promocion
    SET
    --CLAVE  = :CLAVE,
NOMBRE  = :NOMBRE,
DESCRIPCION  = :DESCRIPCION,
SUCURSALID  = :SUCURSALID,
CANTIDAD  = :CANTIDAD,
PRODUCTOID  = :PRODUCTOID,
UTILIDAD  = :UTILIDAD,
CANTIDADLLEVATE  = :CANTIDADLLEVATE,
IMPORTE  = :IMPORTE,
PORCENTAJEDESCUENTO  = :PORCENTAJEDESCUENTO,
TIPOPROMOCIONID  = :TIPOPROMOCIONID,
RANGOPROMOCIONID  = :RANGOPROMOCIONID,
LINEAID  = :LINEAID,
FECHAINICIO  = :FECHAINICIO,
FECHAFIN  = :FECHAFIN,
LUNES  = :LUNES,
MARTES  = :MARTES,
MIERCOLES  = :MIERCOLES,
JUEVES  = :JUEVES,
VIERNES  = :VIERNES,
SABADO  = :SABADO,
DOMINGO  = :DOMINGO,
PORIMPORTE  = :PORIMPORTE,
ENMONEDERO = :ENMONEDERO ,
ACTIVO = :ACTIVO  ,
ESMULTIDETALLE = :ESMULTIDETALLE,
DESCMULTIDETALLE = :DESCMULTIDETALLE

 WHERE ID = :PROMOCIONID;



  END



  suspend;
end
