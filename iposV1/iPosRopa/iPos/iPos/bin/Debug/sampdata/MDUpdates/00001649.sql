CREATE OR ALTER TRIGGER MOVTO_BIU_25 FOR MOVTO
ACTIVE BEFORE INSERT OR UPDATE POSITION 25
AS
DECLARE VARIABLE DESCPORC D_PORCENTAJE;
BEGIN
    IF ((NEW.PRECIOLISTA > NEW.PRECIO)) THEN
    BEGIN

        IF((NEW.DESCUENTO > 0.00) AND (NEW.DESCUENTO = (NEW.PRECIOLISTA - NEW.PRECIO))) THEN
        BEGIN
            DESCPORC = 100.00 * (NEW.DESCUENTO / NEW.PRECIOLISTA);
            NEW.DESCUENTOPORCENTAJE = :DESCPORC;
        end
        ELSE
        BEGIN
            DESCPORC = ((NEW.PRECIOLISTA - NEW.PRECIO) * 100) / NEW.PRECIOLISTA;
            NEW.DESCUENTOPORCENTAJE = :DESCPORC;
        END

    END
    ELSE
    BEGIN
        DESCPORC = 0.00;
        NEW.DESCUENTOPORCENTAJE = :DESCPORC;
    END

    IF (NEW.DESCUENTO > 0.00) THEN
    BEGIN
        NEW.IMPORTEDESCUENTO = NEW.CANTIDAD * NEW.DESCUENTO;
    END
    ELSE
    BEGIN
        NEW.IMPORTEDESCUENTO = 0.00;
    END
END