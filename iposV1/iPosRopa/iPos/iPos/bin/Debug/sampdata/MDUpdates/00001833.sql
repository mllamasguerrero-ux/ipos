create or alter procedure MOVIL_UPDATEPRODHISTFLAG (
    DOCTOID D_FK)
returns (
    ERRORCODE D_ERRORCODE)
as
BEGIN

IF(COALESCE(:DOCTOID,0) = 0) THEN
BEGIN
    UPDATE PRODUCTO SET HISTORIALMOVIL = 'S'
    WHERE ID IN (SELECT DISTINCT PRODUCTOID FROM MOVTO WHERE TIPODOCTOID IN (21,301, 321)) ;
END
ELSE
BEGIN
    UPDATE PRODUCTO SET HISTORIALMOVIL = 'S'   
    WHERE ID IN (SELECT DISTINCT PRODUCTOID FROM MOVTO WHERE DOCTOID = :DOCTOID) ;
END
             

   ERRORCODE = 0;
   SUSPEND;
END