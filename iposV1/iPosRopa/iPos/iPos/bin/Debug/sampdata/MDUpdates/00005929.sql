create or alter procedure PAGO_CAMBIARAPLICADO (
    IDANT D_FK,
    APLICADO D_BOOLCN,
    FECHAAPLICADO D_FECHA,
    MOTIVO_CAMFEC_ID D_FK)
returns (
    ERRORCODE D_ERRORCODE)
as
declare variable DEVUELTO D_BOOLCN;
BEGIN

   SELECT PAGO.DEVUELTO
   FROM PAGO WHERE ID = :IDAnt
   into :DEVUELTO;


  IF(COALESCE(:DEVUELTO,'N') = 'S' AND COALESCE(:APLICADO,'N') = 'N') THEN
  BEGIN
    ERRORCODE = 5029;
    SUSPEND;
    EXIT;
  END
    
  update  PAGO
  set

        APLICADO = :APLICADO,
        FECHAAPLICADO = :FECHAAPLICADO,
        MOTIVO_CAMFEC_ID = :MOTIVO_CAMFEC_ID,
        FECHAPROCESADO = CURRENT_DATE
  where ID=:IDAnt ;


  UPDATE DOCTOPAGO SET APLICADO = :APLICADO, FECHAAPLICADO = :FECHAAPLICADO,MOTIVO_CAMFEC_ID= :MOTIVO_CAMFEC_ID,
  FECHAPROCESADO = CURRENT_DATE
  WHERE PAGOID = :IDAnt;

   ERRORCODE = 0;
   SUSPEND;
   
   WHEN ANY DO
   BEGIN
      ERRORCODE = 1012;
      SUSPEND;
   END
END