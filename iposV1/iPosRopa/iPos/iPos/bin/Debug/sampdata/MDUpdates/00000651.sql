create or alter procedure DOCTO_ACUMULAR_TOTALES (
    DOCTOID D_PK,
    IMPORTE D_PRECIO,
    SUBTOTAL D_PRECIO,
    IVA D_PRECIO,
    TOTAL D_PRECIO,
    ABONOMONEDERO D_PRECIO)
returns (
    ERRORCODE D_ERRORCODE)
as
BEGIN
   -- Tambien al actualizar otro campo que no es totales, este total va a ser cero.
   -- por ejemplo al actualizar estatus.
   UPDATE DOCTO
   SET
      IMPORTE = COALESCE(IMPORTE, 0)  + COALESCE(:IMPORTE, 0),
      SUBTOTAL = COALESCE(SUBTOTAL, 0) + COALESCE(:SUBTOTAL, 0),
      DESCUENTO = COALESCE(IMPORTE, 0) - COALESCE(SUBTOTAL, 0),
      IVA = COALESCE(IVA, 0) + COALESCE(:IVA, 0),
      TOTAL = COALESCE(TOTAL, 0) + COALESCE(:TOTAL, 0),
      CARGO = COALESCE(CARGO, 0) + COALESCE(:TOTAL, 0),
      SALDO = COALESCE(CARGO, 0) - COALESCE(ABONO, 0),
      ABONOMONEDERO =  COALESCE(ABONOMONEDERO, 0) + COALESCE(:ABONOMONEDERO, 0)
   WHERE ID = :DOCTOID;

   ERRORCODE = 0;
   SUSPEND;

   WHEN ANY DO
   BEGIN
      ERRORCODE = 1011;
      SUSPEND;
   END
END