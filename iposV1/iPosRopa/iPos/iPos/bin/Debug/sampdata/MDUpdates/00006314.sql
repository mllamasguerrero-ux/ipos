create or alter procedure CONTRARECIBOHEADER_SAVE (
    CONTRARECIBOID type of D_FK,
    OBSERVACIONES D_STDTEXT_LARGE,
    ESTATUSPAGOID D_FK)
returns (
    ERRORCODE type of D_ERRORCODE)
as
declare variable ESTATUSID D_FK;
BEGIN


    
   IF ((:CONTRARECIBOID IS NULL) OR (:CONTRARECIBOID = 0)) THEN
   BEGIN
      ERRORCODE = 1002;
   END

    SELECT ESTATUSID FROM CONTRARECIBOHDR WHERE ID = :CONTRARECIBOID INTO :ESTATUSID;


    IF(COALESCE(:ESTATUSID,-1) <> 0 ) THEN
    BEGIN
              errorcode = 1002;
              SUSPEND;
              EXIT;

    END



    UPDATE DOCTO SET CONTRARECIBOID = :CONTRARECIBOID WHERE ID IN (SELECT ID FROM contrarecibodtl WHERE CONTRARECIBOID = :CONTRARECIBOID);

    
    UPDATE CONTRARECIBODTL SET ESTATUSID = 1 WHERE CONTRARECIBOID = :CONTRARECIBOID;

    UPDATE CONTRARECIBOHDR SET ESTATUSID = 1, OBSERVACIONES = :OBSERVACIONES, ESTATUSPAGOID = :ESTATUSPAGOID WHERE ID = :CONTRARECIBOID;


   SUSPEND;
END