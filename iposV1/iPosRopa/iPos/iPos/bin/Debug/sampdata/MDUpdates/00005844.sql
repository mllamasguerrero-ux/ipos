create or alter procedure PRODUCTO_CHEQUEDEVUELTO (
    USERID D_FK)
returns (
    PRODUCTOID D_FK,
    ERRORCODE D_ERRORCODE)
as
declare variable MONTO D_PRECIO;
declare variable LINEAID D_FK;
declare variable MARCAID D_FK;
declare variable PROVEEDORID D_FK;
declare variable COSTOREPOSICION D_PRECIO;
declare variable SAT_PRODUCTOSERVICIOID D_FK;
BEGIN


   ERRORCODE = 0;

   MONTO = 0;
   COSTOREPOSICION = 0;
    
   SELECT ID
   FROM PRODUCTO
   WHERE CLAVE = 'CHEQUEDEVUELTO-'
   INTO :PRODUCTOID;




   IF(COALESCE(:PRODUCTOID,0) = 0 ) THEN
   BEGIN



        SELECT ID FROM LINEA WHERE CLAVE = '--CHEQUEDEVUELTO--'
        INTO  :LINEAID;

        IF(COALESCE(:LINEAID, 0) = 0) THEN
        BEGIN
            INSERT INTO linea ( CLAVE, NOMBRE, ACUMULAPROMOCION, DESCUENTOVALE, TIPORECARGA, APLICAMAYOREOXLINEA)
            VALUES('--CHEQUEDEVUELTO--','--CHEQUEDEVUELTO--','N',0,NULL, 'N') returning ID INTO :LINEAID;
        END

    
        IF(COALESCE(:LINEAID,0) = 0 ) THEN
        BEGIN
            ERRORCODE = 1001;
            SUSPEND;
            EXIT;
        END



        SELECT ID FROM MARCA WHERE CLAVE = '--CHEQUEDEVUELTO--'
        INTO  :MARCAID;

        IF(COALESCE(:MARCAID, 0) = 0) THEN
        BEGIN
            INSERT INTO MARCA ( CLAVE, NOMBRE,  DESCONTINUADO)
            VALUES('--CHEQUEDEVUELTO--','--CHEQUEDEVUELTO--','N') returning ID INTO :MARCAID;
        END

    
        IF(COALESCE(:MARCAID,0) = 0 ) THEN
        BEGIN
            ERRORCODE = 1001;
            SUSPEND;
            EXIT;
        END





        SELECT ID FROM PERSONA WHERE CLAVE = '--CHEQUEDEVUELTO--'  AND TIPOPERSONAID = 40
        INTO  :PROVEEDORID;

        IF(COALESCE(:PROVEEDORID, 0) = 0) THEN
        BEGIN
                INSERT INTO PERSONA 
                (
                CLAVE,
                NOMBRE,
                TIPOPERSONAID
                )
                VALUES
                (
                '--CHEQUEDEVUELTO--',
                '--CHEQUEDEVUELTO--',
                40

                ) RETURNING ID INTO :PROVEEDORID;

         END

    
        IF(COALESCE(:PROVEEDORID,0) = 0 ) THEN
        BEGIN
            ERRORCODE = 1001;
            SUSPEND;
            EXIT;
        END

        COSTOREPOSICION = 0;


        SELECT ID FROM SAT_PRODUCTOSERVICIO WHERE SAT_CLAVEPRODSERV = '83111603' INTO :SAT_PRODUCTOSERVICIOID;


    SELECT PRODUCTOID , ERRORCODE FROM PRODUCTO_INSERT (
    'S',
    :USERID, --CREADO
    :USERID, --MODIFICADO
    'CHEQUEDEVUELTO-' ,--CLAVE D_CLAVE,
    'CHEQUE DEVUELTO',--NOMBRE D_NOMBRE,
    'CHEQUE DEVUELTO',--DESCRIPCION D_DESCRIPCION,
    '',--EAN D_CLAVE,
    'CHEQUE DEVUELTO',--DESCRIPCION1 D_STDTEXT_MEDIUM,
    'CHEQUE DEVUELTO',--DESCRIPCION2 D_STDTEXT_MEDIUM,
    'CHEQUE DEVUELTO',-- DESCRIPCION3 varchar(40),
    :PROVEEDORID,--PROVEEDOR1ID integer,
    :PROVEEDORID,--PROVEEDOR2ID integer,
    :LINEAID,-- LINEAID integer,
    :MARCAID,-- MARCAID integer,
    :MONTO, --PRECIO1 D_PRECIO,
    :MONTO, --PRECIO2 D_PRECIO,
    :MONTO, --PRECIO3 D_PRECIO,
    :MONTO, --PRECIO4 D_PRECIO,
    :MONTO, --PRECIO5 D_PRECIO,
    0,--TASAIVAID D_FK,
    0,--TASAIVA D_PORCENTAJE,
    1,-- MONEDAID D_FK,
    :COSTOREPOSICION, --COSTOREPOSICION D_COSTO,
    :COSTOREPOSICION, -- COSTOULTIMO D_COSTO,
    :COSTOREPOSICION, --COSTOPROMEDIO D_COSTO,
    NULL,--PRODUCTOSUSTITUTOID D_FK,
    'N',--MANEJALOTE D_BOOLCN,
    'N',--ESKIT D_BOOLCN,
    'N',--IMPRIMIR D_BOOLCN,
    'N',--INVENTARIABLE D_BOOLCN,
    'S',--NEGATIVOS D_BOOLCN,
    0,--LIMITEPRECIO2 D_CANTIDAD,
    :MONTO,--PRECIOMAXIMOPUBLICO D_PRECIO,
    NULL,--FECHACAMBIOPRECIO D_FECHA,
    'N',--MANEJASTOCK D_BOOLCN,
    0,--STOCK D_CANTIDAD,
    'N',--CAMBIARPRECIO D_BOOLCN,
    0,--COMISION D_PRECIO,
    0,-- OFERTA D_PRECIO,
    'N',--TOMARPRECIOPADRE D_BOOLCN,
    'N',--TOMARCOMISIONPADRE D_BOOLCN,
    'N',-- TOMAROFERTAPADRE D_BOOLCN,
    NULL,--PRODUCTOPADRE D_FK,
    NULL,--TEXTO1 D_STDTEXT_LIGHT,
    NULL,--TEXTO2 D_STDTEXT_LIGHT,
    NULL,--TEXTO3 D_STDTEXT_LIGHT,
    NULL,--TEXTO4 D_STDTEXT_LIGHT,
    NULL,--TEXTO5 D_STDTEXT_MEDIUM,
    NULL,--TEXTO6 D_STDTEXT_LARGE,
    NULL,--NUMERO1 D_PRECIO,
    NULL,--NUMERO2 D_PRECIO,
    NULL,--NUMERO3 D_PRECIO,
    NULL,--NUMERO4 D_PRECIO,
    NULL,--FECHA1 D_FECHA,
    NULL,--FECHA2 D_FECHA,
    1,--PZACAJA D_CANTIDAD,
    1,--U_EMPAQUE D_CANTIDAD,
    'PZA',--UNIDAD varchar(10),
    NULL,--CBARRAS D_CLAVE_NULL,
    NULL,--CEMPAQUE D_CLAVE_NULL,
    NULL,--PLUG D_CLAVE_NULL,
    'N',--MAYOKGS D_BOOLCN,
    0,--INI_MAYO D_CANTIDAD,
    'N',--DESCRIPCION_COMODIN D_BOOLCN,
    NULL,--CUENTAPREDIAL D_STDTEXT_64,
    NULL,--IMAGEN D_IMAGEN,
    0,--TASAIEPS D_PORCENTAJE,
    0,--TASAIMPUESTO D_PORCENTAJE,
    0,--MINUTILIDAD D_PORCENTAJE,
    NULL,--SPRECIO1 D_PRECIO,
    NULL,--SPRECIO2 D_PRECIO,
    NULL,--SPRECIO3 D_PRECIO,
    NULL,--SPRECIO4 D_PRECIO,
    NULL,--SPRECIO5 D_PRECIO,
    0,--DESCUENTO D_PORCENTAJE,
    'N',--REQUIERERECETA D_BOOLCN,
    :MONTO,--PRECIOSUGERIDO D_PRECIO,
    :MONTO,--PRECIOTOPE D_PRECIO,
    0,--STOCKMAX D_CANTIDAD,
    'N',--SURTIRPORCAJA D_BOOLCN,
    'N',--TIPOABC D_BOOLCN,
    'N',--PRECIOMAT char(1),
    :MONTO,
    0,
    NULL,
    0,
    NULL,
    'PZA',
    0.0,
    'N',
    NULL,
    NULL,
    'N',
    null,
    NULL,
    :SAT_PRODUCTOSERVICIOID,
    NULL,
    'N',
    'N',
     NULL,
     NULL,
     NULL)--PRECIO6 D_PRECIO)
    INTO :PRODUCTOID , :ERRORCODE;

    IF(COALESCE(:ERRORCODE ,0) <> 0) then
    BEGIN
        SUSPEND;
        EXIT;
    END



   END


   SUSPEND;

END