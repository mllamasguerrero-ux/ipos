create or alter procedure BUFFERTEXT_ADD (
    BUFFERGROUP integer,
    BUFFERVALUEID D_FK)
returns (
    BUFFERGROUP_OUT integer,
    ERRORCODE D_ERRORCODE)
as
BEGIN
  ERRORCODE = 0;

  IF(COALESCE(BUFFERGROUP,0) = 0) THEN
  BEGIN
      SELECT COALESCE(MAX(BUFFERGROUP),0) + 1 AS NEWBUFFERGROUP
      FROM BUFFERTEXT
      INTO  :BUFFERGROUP_OUT ;
  END
  ELSE
  BEGIN
       BUFFERGROUP_OUT = :BUFFERGROUP;
  END

  INSERT INTO BUFFERTEXT
  (BUFFERGROUP, BUFFERVALUEID)
  VALUES
  (:BUFFERGROUP_OUT, :BUFFERVALUEID);
   
   SUSPEND;
   
   WHEN ANY DO
   BEGIN
      ERRORCODE = 1006;
      SUSPEND;
   END
 END