/*
	Procedure GET_DERECHO
	
	IN		USUARIOID D_PK,
			DERECHOID D_PK
			
	OUT	ACCESO D_BOOLCN
	
	Determinar si un usuario USUARIOID
	tiene habilitado cierto derecho DERECHOID
	
	Regresa 'S'/'N'
*/
CREATE OR ALTER PROCEDURE GET_DERECHO (
    USUARIOID D_PK,
    DERECHOID D_PK)
RETURNS (
    ACCESO D_BOOLCN)
AS
DECLARE VARIABLE ACCESOCOUNT INTEGER;
BEGIN
   ACCESO = 'N';

   SELECT COALESCE(COUNT(PD.PD_DERECHO), 0)
   FROM PERFIL_DER PD
   WHERE PD.PD_DERECHO = :DERECHOID
     AND PD.PD_PERFIL IN (
         SELECT UP.UP_PERFIL
         FROM USUARIO_PERFIL UP
         WHERE UP.UP_PERSONAID = :USUARIOID)
   INTO :ACCESOCOUNT;

   IF (:ACCESOCOUNT >= 1) THEN
      ACCESO = 'S';
   ELSE
      ACCESO = 'N';

   SUSPEND;
END;

