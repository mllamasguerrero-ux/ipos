create or alter procedure INVFIS_UNICOLOTE_APLICARSALIDAS (
    DOCTOREFERENCIAID D_FK)
returns (
    ERRORCODE D_ERRORCODE)
as
declare variable DOCTOIDSALIDA D_FK;
declare variable FECHAREFERENCIA D_FECHA;
BEGIN

   ERRORCODE = 0;



   SELECT FECHA FROM DOCTO WHERE ID = :DOCTOREFERENCIAID INTO :FECHAREFERENCIA;

   FOR
       SELECT ID FROM DOCTO
       WHERE FECHA = :FECHAREFERENCIA AND DOCTOREFID = :DOCTOREFERENCIAID
        AND SUBTIPODOCTOID = 18
        INTO :DOCTOIDSALIDA
   DO
   BEGIN

        SELECT ERRORCODE FROM  INVFIS_DIF_APLICAR (:DOCTOIDSALIDA, NULL)  INTO :ERRORCODE;
         
        IF ((:ERRORCODE IS NOT NULL) AND (:ERRORCODE > 0)) THEN
        BEGIN
         SUSPEND;
         EXIT;
        END


    END




   
   ERRORCODE = 0;
   SUSPEND;

   
  /* WHEN ANY DO
   BEGIN
     ERRORCODE = 1076;
     SUSPEND;
   END  */

   END