create or alter procedure GET_LISTAPRECIO_PORRANGO (
    PRODUCTOID D_FK,
    PRECIO D_PRECIO)
returns (
    LISTAPRECIOID D_FK,
    ERRORCODE D_ERRORCODE)
as
declare variable PRECIO1 D_PRECIO;   
declare variable PRECIO2 D_PRECIO;
declare variable PRECIO3 D_PRECIO;
declare variable PRECIO4 D_PRECIO;
declare variable PRECIO5 D_PRECIO;   
declare variable COSTOREPOSICION D_COSTO;

BEGIN
   ERRORCODE = 0;


   SELECT PRECIO1, PRECIO2, PRECIO3, PRECIO4, PRECIO5, COSTOREPOSICION
   FROM PRODUCTO
   WHERE ID = :PRODUCTOID
   INTO :PRECIO1, :PRECIO2, :PRECIO3, :PRECIO4, :PRECIO5, :COSTOREPOSICION;


   PRECIO = COALESCE(:PRECIO, 0.00); 
   PRECIO1 = COALESCE(:PRECIO1, 0.00);
   PRECIO2 = COALESCE(:PRECIO2, 0.00);
   PRECIO3 = COALESCE(:PRECIO3, 0.00);
   PRECIO4 = COALESCE(:PRECIO4, 0.00);
   PRECIO5 = COALESCE(:PRECIO5, 0.00); 
   COSTOREPOSICION = COALESCE(:COSTOREPOSICION, 0.00);

   IF ((:PRECIO >= :PRECIO1) ) THEN
   BEGIN
      LISTAPRECIOID = 1;
      SUSPEND;
      EXIT;
   END

   IF ((:PRECIO >= :PRECIO2) AND (:PRECIO < :PRECIO1)) THEN
   BEGIN
      LISTAPRECIOID = 2;
      SUSPEND;
      EXIT;
   END
   
   IF ((:PRECIO >= :PRECIO3) AND (:PRECIO < :PRECIO2)) THEN
   BEGIN
      LISTAPRECIOID = 3;
      SUSPEND;
      EXIT;
   END

   
   IF ((:PRECIO >= :PRECIO4) AND (:PRECIO < :PRECIO3)) THEN
   BEGIN
      LISTAPRECIOID = 4;
      SUSPEND;
      EXIT;
   END
   
   IF ((:PRECIO >= :PRECIO5) AND (:PRECIO < :PRECIO4)) THEN
   BEGIN
      LISTAPRECIOID = 5;
      SUSPEND;
      EXIT;
   END    

   IF ((:PRECIO >= :COSTOREPOSICION) AND (:PRECIO < :PRECIO5)) THEN
   BEGIN
      LISTAPRECIOID = 6;
      SUSPEND;
      EXIT;
   END

   IF (:PRECIO <  :COSTOREPOSICION) THEN
   BEGIN
      LISTAPRECIOID = 7;
      SUSPEND;
      EXIT;
   END

   WHEN ANY DO
   BEGIN
      LISTAPRECIOID = -1;
      ERRORCODE = 3333;
      SUSPEND;
      EXIT;
   END
      
END
