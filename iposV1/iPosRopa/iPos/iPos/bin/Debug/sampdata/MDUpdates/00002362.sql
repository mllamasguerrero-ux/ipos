CREATE OR ALTER TRIGGER PERSONA_BI FOR PERSONA
ACTIVE BEFORE INSERT POSITION 0
AS
declare variable PREFIJOCLIENTE D_STDTEXT_SHORT;
declare variable CLIENTENEXTANAMEID D_FK;
declare variable C_TIMESTAMP D_TIMESTAMP;
BEGIN

          
  C_TIMESTAMP = CURRENT_TIMESTAMP;

  IF (NEW.ID IS NULL) THEN
    NEW.ID = GEN_ID(SEQ_PERSONA, 1);
    
  IF (NEW.ACTIVO IS NULL) THEN
    NEW.ACTIVO = 'Y';

  IF (NEW.CREADO IS NULL) THEN
    NEW.CREADO = CURRENT_TIMESTAMP;
    
  IF (NEW.MODIFICADO IS NULL) THEN
    NEW.MODIFICADO = C_TIMESTAMP;
    
  IF (NEW.REPLMODIFICADO IS NULL) THEN
    NEW.REPLMODIFICADO = C_TIMESTAMP;
    
   
  IF (NEW.REPLCREADO IS NULL) THEN
    NEW.REPLCREADO = C_TIMESTAMP;



  IF (NEW.CLAVE IS NULL) then
  BEGIN
       IF(NEW.TIPOPERSONAID = 50) THEN
       BEGIN
                SELECT PREFIJOCLIENTE FROM PARAMETRO INTO :PREFIJOCLIENTE;
                CLIENTENEXTANAMEID = GEN_ID(GEN_CLIENTE,1);
                NEW.CLAVE = COALESCE(:PREFIJOCLIENTE,'CL') || lpad(CAST( CLIENTENEXTANAMEID AS varchar(31)),6,'0') ;
       END
       ELSE
       BEGIN
            NEW.CLAVE = 'C_' || lpad(CAST( NEW.id AS varchar(31)),6,'0') ;
       END
  END


END