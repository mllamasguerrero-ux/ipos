create or alter procedure EMIDA_VENTASCORTE_INCONCLUSAS (
    CAJEROID D_FK)
returns (
    CUENTAINCONCLUSOS integer,
    ERRORCODE D_ERRORCODE)
as
declare variable FECHACORTE D_FECHA;
declare variable HAYCORTEACTIVO D_BOOLCN;
declare variable CORTEID D_FK;
declare variable SERVICIOSEMIDA D_BOOLCN_NULL;
declare variable HABPAGOSERVEMIDA D_BOOLCN_NULL;
BEGIN

   CUENTAINCONCLUSOS = 0;

   SELECT FIRST 1 SERVICIOSEMIDA, HABPAGOSERVEMIDA
   FROM PARAMETRO INTO :SERVICIOSEMIDA, :HABPAGOSERVEMIDA;

   IF(COALESCE(:SERVICIOSEMIDA , 'N') = 'N' AND (coalesce(:HABPAGOSERVEMIDA,'N') = 'N') ) THEN
   BEGIN
    SUSPEND;
    EXIT;
   END



   select FECHACORTE, HAYCORTEACTIVO, CORTEID
    FROM HAY_CORTE_ACTIVO(:CAJEROID) INTO :FECHACORTE, :HAYCORTEACTIVO, :CORTEID ;

    SELECT COUNT(*) FROM DOCTO WHERE CORTEID = :CORTEID AND TIPODOCTOID = 21
    AND SUBTIPODOCTOID IN (22,24) AND ESTATUSDOCTOID = 0
    INTO :CUENTAINCONCLUSOS;

    CUENTAINCONCLUSOS = COALESCE(:CUENTAINCONCLUSOS,0);

    ERRORCODE = 0;

   SUSPEND;
END