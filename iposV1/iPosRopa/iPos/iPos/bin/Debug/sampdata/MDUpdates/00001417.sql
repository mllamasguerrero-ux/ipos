create or alter procedure KARDEX_INVENTARIO_UPDATE (
    DOCTOID D_FK,
    MOVTOID D_FK,
    PRODUCTOID D_FK,
    LOTE D_LOTE,
    FECHAVENCE D_FECHAVENCE,
    CANTIDAD D_CANTIDAD,
    PRECIO D_PRECIO,
    COSTO D_COSTO,
    ORIGENFISCALID D_FK,
    ESAPARTADO D_BOOLCN,
    KARDEXID D_FK)
returns (
    OK D_BOOLCN,
    ERRORCODE D_ERRORCODE)
as
declare variable SENTIDOINVENTARIO D_SENTIDO;
declare variable SENTIDOINVENTARIOAPARTADOS D_SENTIDO;
declare variable ALMACENID D_FK;
BEGIN

   IF (:DOCTOID IS NULL) THEN
   BEGIN
      ERRORCODE = 1032;
   END
   
   IF (:MOVTOID IS NULL) THEN
   BEGIN
      ERRORCODE = 1033;
   END

   IF ((:CANTIDAD IS NULL) OR (:CANTIDAD = 0)) THEN
   BEGIN
      ERRORCODE = 1034;
   END

   SELECT SENTIDOINVENTARIO, ALMACENID, SENTIDOINVENTARIOAPARTADOS
   FROM GET_DOCTO_PARAMS(:DOCTOID)
   INTO :SENTIDOINVENTARIO, :ALMACENID, :SENTIDOINVENTARIOAPARTADOS;

   -- Aplicar el sentido del tipomovto
   IF(:ESAPARTADO = 'N') THEN
   BEGIN
    CANTIDAD = :SENTIDOINVENTARIO * :CANTIDAD;
   END
   ELSE
   BEGIN  
    CANTIDAD = :SENTIDOINVENTARIOAPARTADOS * :CANTIDAD;
   END

   SELECT OK, ERRORCODE
   FROM INVENTARIO_UI (
      :ALMACENID, :PRODUCTOID, :LOTE, :FECHAVENCE, :CANTIDAD, :PRECIO, :COSTO ,:ORIGENFISCALID,:ESAPARTADO, :KARDEXID
   ) INTO :OK, :ERRORCODE;

   ERRORCODE = 0;
   SUSPEND;

   WHEN ANY DO
   BEGIN
      ERRORCODE = 1035;
      SUSPEND;
   END
END