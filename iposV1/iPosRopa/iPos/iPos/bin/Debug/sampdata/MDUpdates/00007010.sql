create or alter procedure DOCTO_ACTUALIZAR_CLIENTE (
    DOCTOID type of D_FK,
    PERSONAID type of D_FK)
returns (
    ERRORCODE type of D_ERRORCODE)
as
declare variable MONEDAID D_FK;
declare variable TIPOCAMBIO D_TIPOCAMBIO;
declare variable PLAZO D_DOCTOPLAZO;
declare variable RECALCULARCAMBIOCLIENTE D_BOOLCS;
BEGIN

  ERRORCODE = 0;

  SELECT COALESCE(MONEDAID,1) FROM PERSONA WHERE ID = :PERSONAID INTO :MONEDAID;
  SELECT COALESCE(TIPOCAMBIO,1) FROM MONEDA WHERE ID = :MONEDAID INTO :TIPOCAMBIO;

  SELECT FIRST 1 RECALCULARCAMBIOCLIENTE FROM PARAMETRO INTO :RECALCULARCAMBIOCLIENTE;

  
   SELECT first 1 PERSONA.dias FROM PERSONA WHERE ID = :PERSONAID INTO :PLAZO;

   if(:plazo is null) then
   begin
      plazo = 0;
   end



   UPDATE DOCTO
   SET PERSONAID = :PERSONAID ,
   MONEDAID = :MONEDAID,
   TIPOCAMBIO = :TIPOCAMBIO ,
   PLAZO = :PLAZO,
   VENCE = DATEADD(:PLAZO DAY TO COALESCE(FECHA, CURRENT_DATE)),
   DOM_ENTREGAID = NULL
   WHERE ID = :DOCTOID;

   IF(COALESCE(:RECALCULARCAMBIOCLIENTE,'S') = 'S') THEN
   BEGIN
      SELECT ERRORCODE
      FROM DOCTO_RECALCULAR_DETALLES (
         :DOCTOID
      ) INTO :ERRORCODE;
   END

      SUSPEND;

    WHEN ANY DO
   BEGIN
      ERRORCODE = 1016;
      SUSPEND;
   END

END