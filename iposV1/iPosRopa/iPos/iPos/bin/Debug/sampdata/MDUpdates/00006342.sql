create or alter procedure EXISTE_COMPRA_MOVIL (
    REFERENCIA D_REFERENCIA,
    CLAVEVENDEDOR D_CLAVE)
returns (
    CUENTASIMILARES D_INTEGER,
    ERRORCODE D_ERRORCODE)
as
declare variable PERSONAID D_FK;
declare variable TIPODOCTOID D_FK;
declare variable SUCURSALID D_FK;
declare variable VENDEDORID D_FK;
BEGIN

   TIPODOCTOID = 341;
   VENDEDORID = 17;
   PERSONAID = 1;
   CUENTASIMILARES = 0;

   SELECT SUCURSALID FROM PARAMETRO INTO :SUCURSALID;


      
      IF(COALESCE(CLAVEVENDEDOR,'') <> '') THEN
      BEGIN
         SELECT first 1 id from persona where clave = :CLAVEVENDEDOR AND TIPOPERSONAID IN (20,22) into :VENDEDORID;

      END


      SELECT COUNT(*) FROM DOCTO WHERE TIPODOCTOID = 341 AND VENDEDORID = :VENDEDORID AND COALESCE(REFERENCIA, '') = COALESCE(:REFERENCIA, '') INTO :cuentasimilares;




   suspend;

END