create or alter procedure FACTURAELECTRONICA_XML_CORE (
    DOCTOID D_FK,
    DESGLOSEIEPSPARENT D_BOOLCN_NULL,
    MOSTRARDESCUENTOPARENT D_BOOLCN_NULL)
returns (
    ID D_FK,
    TIPOLINEA D_NOMBRE_NULL,
    PADRELINEA integer,
    ORDENLINEA integer,
    SUBORDEN integer,
    SERIE D_STDTEXT_64,
    FOLIO D_STDTEXT_64,
    FECHA D_TIMESTAMP,
    TIPOCOMPROBANTE D_STDTEXT_64,
    FORMAPAGO D_STDTEXT_64,
    SUBTOTAL D_IMPORTE,
    DESCUENTO D_IMPORTE,
    TOTAL D_IMPORTE,
    MONEDA D_STDTEXT_64,
    TIPOCAMBIO D_STDTEXT_64,
    CONDICIONESPAGO D_STDTEXT_LARGE,
    METODOPAGO D_STDTEXT_64,
    MOTIVODESCUENTO D_STDTEXT_64,
    LUGAREXPEDICION D_STDTEXT_LARGE,
    NUMEROCTAPAGO D_STDTEXT_LARGE,
    SERIEFOLIOFISCALORIGINAL D_STDTEXT_64,
    FOLIOFISCALORIGINAL D_STDTEXT_64,
    MONTOFOLIOFISCALORIGINAL D_IMPORTE,
    FECHAFOLIOFISCALORIGINAL D_FECHA,
    RFC D_STDTEXT_64,
    RAZONSOCIAL D_STDTEXT_LARGE,
    REGIMENFISCAL D_STDTEXT_64,
    CALLE D_STDTEXT_LARGE,
    NOINTERIOR D_STDTEXT_64,
    NOEXTERIOR D_STDTEXT_64,
    COLONIA D_STDTEXT_LARGE,
    LOCALIDAD D_STDTEXT_LARGE,
    REFERENCIA D_STDTEXT_LARGE,
    MUNICIPIO D_STDTEXT_LARGE,
    ESTADO D_STDTEXT_MEDIUM,
    PAIS D_STDTEXT_64,
    CODIGOPOSTAL D_STDTEXT_64,
    NOMBRE D_STDTEXT_LARGE,
    RESIDENCIAFISCAL D_STDTEXT_LARGE,
    NUMREGIDTRIB D_STDTEXT_64,
    USOCFDI D_STDTEXT_64,
    CANTIDAD D_CANTIDAD,
    UNIDAD D_STDTEXT_64,
    DESCRIPCION D_SAT_DESCRIPCION,
    VALORUNITARIO D_IMPORTE,
    IMPORTE D_IMPORTE,
    NOIDENTIFICACION D_STDTEXT_64,
    CUENTAPREDIAL D_STDTEXT_64,
    CLAVEPRODSERV D_STDTEXT_64,
    CLAVEUNIDAD D_STDTEXT_64,
    NUMERO D_STDTEXT_64,
    ADUANA D_STDTEXT_64,
    IMPUESTO D_STDTEXT_64,
    TASA D_PORCENTAJE,
    BASEIMP D_COSTO,
    TIPOFACTOR D_STDTEXT_64,
    TASACUOTA D_STDTEXT_64,
    FECHAPAGO D_FECHA,
    FORMADEPAGOP D_STDTEXT_64,
    MONEDAP D_STDTEXT_64,
    TIPOCAMBIOP D_STDTEXT_64,
    MONTO D_IMPORTE,
    NUMOPERACION D_STDTEXT_64,
    RFCEMISORCTAORD D_STDTEXT_64,
    NOMBANCOORDEXT D_NOMBRE_NULL,
    CTAORDENANTE D_STDTEXT_64,
    RFCEMISORCTABEN D_STDTEXT_64,
    CTABENEFICIARIO D_STDTEXT_64,
    TIPOCADPAGO D_STDTEXT_64,
    CERTPAGO D_STDTEXT_64,
    CADPAGO D_STDTEXT_64,
    SELLOPAGO D_STDTEXT_64,
    IDDOCUMENTO D_STDTEXT_64,
    MONEDADR D_STDTEXT_64,
    TIPOCAMBIODR D_STDTEXT_64,
    METODODEPAGODR D_STDTEXT_64,
    NUMPARCIALIDAD D_STDTEXT_64,
    IMPSALDOANT D_IMPORTE,
    IMPPAGADO D_IMPORTE,
    IMPSALDOINSOLUTO D_IMPORTE,
    TOTALTRASLADOS D_IMPORTE,
    TOTALRETENCIONES D_IMPORTE,
    TIPORELACION D_STDTEXT_64,
    UUID D_STDTEXT_64,
    IMPRIMIRCOMPROBANTESPAGO D_BOOLCN,
    NUMEROPEDIMENTO D_STDTEXT_64,
    MOVTOID D_FK,
    MOVTOKITID D_FK,
    PAGOSATID D_FK,
    MOVTOREFID D_FK,
    EXPORTACION D_STDTEXT_64,
    OBJETOIMP D_STDTEXT_64,
    DOMICILIOFISCAL D_STDTEXT_64,
    PERIODICIDAD D_STDTEXT_64,
    MESES D_STDTEXT_64,
    ANIO D_STDTEXT_64)
as
BEGIN



  FOR SELECT
    ID,
    TIPOLINEA,
    PADRELINEA,
    ORDENLINEA,
    SUBORDEN,
    SERIE,
    FOLIO,
    FECHA,
    TIPOCOMPROBANTE,
    FORMAPAGO,
    SUBTOTAL,
    DESCUENTO,
    TOTAL,
    MONEDA,
    TIPOCAMBIO,
    CONDICIONESPAGO,
    METODOPAGO,
    MOTIVODESCUENTO,
    LUGAREXPEDICION,
    NUMEROCTAPAGO,
    SERIEFOLIOFISCALORIGINAL,
    FOLIOFISCALORIGINAL,
    MONTOFOLIOFISCALORIGINAL,
    FECHAFOLIOFISCALORIGINAL,
    RFC,
    RAZONSOCIAL,
    REGIMENFISCAL,
    CALLE,
    NOINTERIOR,
    NOEXTERIOR,
    COLONIA,
    LOCALIDAD,
    REFERENCIA,
    MUNICIPIO,
    ESTADO,
    PAIS,
    CODIGOPOSTAL,
    NOMBRE,
    RESIDENCIAFISCAL,
    NUMREGIDTRIB,
    USOCFDI,
    CANTIDAD,
    UNIDAD,
    DESCRIPCION,
    VALORUNITARIO,
    IMPORTE,
    NOIDENTIFICACION,
    CUENTAPREDIAL,
    CLAVEPRODSERV,
    CLAVEUNIDAD,
    NUMERO,
    ADUANA,
    IMPUESTO,
    TASA,
    BASEIMP,
    TIPOFACTOR,
    TASACUOTA,
    FECHAPAGO,
    FORMADEPAGOP,
    MONEDAP,
    TIPOCAMBIOP,
    MONTO,
    NUMOPERACION,
    RFCEMISORCTAORD,
    NOMBANCOORDEXT,
    CTAORDENANTE,
    RFCEMISORCTABEN,
    CTABENEFICIARIO,
    TIPOCADPAGO,
    CERTPAGO,
    CADPAGO,
    SELLOPAGO,
    IDDOCUMENTO,
    MONEDADR,
    TIPOCAMBIODR,
    METODODEPAGODR,
    NUMPARCIALIDAD,
    IMPSALDOANT,
    IMPPAGADO,
    IMPSALDOINSOLUTO,
    TOTALTRASLADOS,
    TOTALRETENCIONES,
    TIPORELACION,
    UUID,
    IMPRIMIRCOMPROBANTESPAGO,
    NUMEROPEDIMENTO,
    MOVTOID,
    MOVTOKITID,
    PAGOSATID,
    MOVTOREFID,
    EXPORTACION ,
    OBJETOIMP ,
    DOMICILIOFISCAL ,
    PERIODICIDAD ,
    MESES ,
    ANIO

    FROM
            FACTURAELECTRONICA_XML_CORE_1(:DOCTOID, :DESGLOSEIEPSPARENT, :MOSTRARDESCUENTOPARENT)

    UNION
        SELECT
    ID,
    TIPOLINEA,
    PADRELINEA,
    ORDENLINEA,
    SUBORDEN,
    SERIE,
    FOLIO,
    FECHA,
    TIPOCOMPROBANTE,
    FORMAPAGO,
    SUBTOTAL,
    DESCUENTO,
    TOTAL,
    MONEDA,
    TIPOCAMBIO,
    CONDICIONESPAGO,
    METODOPAGO,
    MOTIVODESCUENTO,
    LUGAREXPEDICION,
    NUMEROCTAPAGO,
    SERIEFOLIOFISCALORIGINAL,
    FOLIOFISCALORIGINAL,
    MONTOFOLIOFISCALORIGINAL,
    FECHAFOLIOFISCALORIGINAL,
    RFC,
    RAZONSOCIAL,
    REGIMENFISCAL,
    CALLE,
    NOINTERIOR,
    NOEXTERIOR,
    COLONIA,
    LOCALIDAD,
    REFERENCIA,
    MUNICIPIO,
    ESTADO,
    PAIS,
    CODIGOPOSTAL,
    NOMBRE,
    RESIDENCIAFISCAL,
    NUMREGIDTRIB,
    USOCFDI,
    CANTIDAD,
    UNIDAD,
    DESCRIPCION,
    VALORUNITARIO,
    IMPORTE,
    NOIDENTIFICACION,
    CUENTAPREDIAL,
    CLAVEPRODSERV,
    CLAVEUNIDAD,
    NUMERO,
    ADUANA,
    IMPUESTO,
    TASA,
    BASEIMP,
    TIPOFACTOR,
    TASACUOTA,
    FECHAPAGO,
    FORMADEPAGOP,
    MONEDAP,
    TIPOCAMBIOP,
    MONTO,
    NUMOPERACION,
    RFCEMISORCTAORD,
    NOMBANCOORDEXT,
    CTAORDENANTE,
    RFCEMISORCTABEN,
    CTABENEFICIARIO,
    TIPOCADPAGO,
    CERTPAGO,
    CADPAGO,
    SELLOPAGO,
    IDDOCUMENTO,
    MONEDADR,
    TIPOCAMBIODR,
    METODODEPAGODR,
    NUMPARCIALIDAD,
    IMPSALDOANT,
    IMPPAGADO,
    IMPSALDOINSOLUTO,
    TOTALTRASLADOS,
    TOTALRETENCIONES,
    TIPORELACION,
    UUID,
    IMPRIMIRCOMPROBANTESPAGO,
    NUMEROPEDIMENTO,
    MOVTOID,
    MOVTOKITID,
    PAGOSATID,
    MOVTOREFID,
    EXPORTACION ,
    OBJETOIMP ,
    DOMICILIOFISCAL ,
    PERIODICIDAD ,
    MESES ,
    ANIO

    FROM
            FACTURAELECTRONICA_XML_CORE_2(:DOCTOID, :DESGLOSEIEPSPARENT, :MOSTRARDESCUENTOPARENT)


    union
    SELECT
    ID,
    TIPOLINEA,
    PADRELINEA,
    ORDENLINEA,
    SUBORDEN,
    SERIE,
    FOLIO,
    FECHA,
    TIPOCOMPROBANTE,
    FORMAPAGO,
    SUBTOTAL,
    DESCUENTO,
    TOTAL,
    MONEDA,
    TIPOCAMBIO,
    CONDICIONESPAGO,
    METODOPAGO,
    MOTIVODESCUENTO,
    LUGAREXPEDICION,
    NUMEROCTAPAGO,
    SERIEFOLIOFISCALORIGINAL,
    FOLIOFISCALORIGINAL,
    MONTOFOLIOFISCALORIGINAL,
    FECHAFOLIOFISCALORIGINAL,
    RFC,
    RAZONSOCIAL,
    REGIMENFISCAL,
    CALLE,
    NOINTERIOR,
    NOEXTERIOR,
    COLONIA,
    LOCALIDAD,
    REFERENCIA,
    MUNICIPIO,
    ESTADO,
    PAIS,
    CODIGOPOSTAL,
    NOMBRE,
    RESIDENCIAFISCAL,
    NUMREGIDTRIB,
    USOCFDI,
    CANTIDAD,
    UNIDAD,
    DESCRIPCION,
    VALORUNITARIO,
    IMPORTE,
    NOIDENTIFICACION,
    CUENTAPREDIAL,
    CLAVEPRODSERV,
    CLAVEUNIDAD,
    NUMERO,
    ADUANA,
    IMPUESTO,
    TASA,
    BASEIMP,
    TIPOFACTOR,
    TASACUOTA,
    FECHAPAGO,
    FORMADEPAGOP,
    MONEDAP,
    TIPOCAMBIOP,
    MONTO,
    NUMOPERACION,
    RFCEMISORCTAORD,
    NOMBANCOORDEXT,
    CTAORDENANTE,
    RFCEMISORCTABEN,
    CTABENEFICIARIO,
    TIPOCADPAGO,
    CERTPAGO,
    CADPAGO,
    SELLOPAGO,
    IDDOCUMENTO,
    MONEDADR,
    TIPOCAMBIODR,
    METODODEPAGODR,
    NUMPARCIALIDAD,
    IMPSALDOANT,
    IMPPAGADO,
    IMPSALDOINSOLUTO,
    TOTALTRASLADOS,
    TOTALRETENCIONES,
    TIPORELACION,
    UUID,
    IMPRIMIRCOMPROBANTESPAGO,
    NUMEROPEDIMENTO,
    MOVTOID,
    MOVTOKITID,
    PAGOSATID,
    MOVTOREFID,
    EXPORTACION ,
    OBJETOIMP ,
    DOMICILIOFISCAL ,
    PERIODICIDAD ,
    MESES ,
    ANIO

    FROM
            FACTURAELECTRONICA_XML_CORE_3(:DOCTOID, :DESGLOSEIEPSPARENT, :MOSTRARDESCUENTOPARENT)


     INTO
    :ID,
    :TIPOLINEA,
    :PADRELINEA,
    :ORDENLINEA,
    :SUBORDEN,
    :SERIE,
    :FOLIO,
    :FECHA,
    :TIPOCOMPROBANTE,
    :FORMAPAGO,
    :SUBTOTAL,
    :DESCUENTO,
    :TOTAL,
    :MONEDA,
    :TIPOCAMBIO,
    :CONDICIONESPAGO,
    :METODOPAGO,
    :MOTIVODESCUENTO,
    :LUGAREXPEDICION,
    :NUMEROCTAPAGO,
    :SERIEFOLIOFISCALORIGINAL,
    :FOLIOFISCALORIGINAL,
    :MONTOFOLIOFISCALORIGINAL,
    :FECHAFOLIOFISCALORIGINAL,
    :RFC,
    :RAZONSOCIAL,
    :REGIMENFISCAL,
    :CALLE,
    :NOINTERIOR,
    :NOEXTERIOR,
    :COLONIA,
    :LOCALIDAD,
    :REFERENCIA,
    :MUNICIPIO,
    :ESTADO,
    :PAIS,
    :CODIGOPOSTAL,
    :NOMBRE,
    :RESIDENCIAFISCAL,
    :NUMREGIDTRIB,
    :USOCFDI,
    :CANTIDAD,
    :UNIDAD,
    :DESCRIPCION,
    :VALORUNITARIO,
    :IMPORTE,
    :NOIDENTIFICACION,
    :CUENTAPREDIAL,
    :CLAVEPRODSERV,
    :CLAVEUNIDAD,
    :NUMERO,
    :ADUANA,
    :IMPUESTO,
    :TASA,
    :BASEIMP,
    :TIPOFACTOR,
    :TASACUOTA,
    :FECHAPAGO,
    :FORMADEPAGOP,
    :MONEDAP,
    :TIPOCAMBIOP,
    :MONTO,
    :NUMOPERACION,
    :RFCEMISORCTAORD,
    :NOMBANCOORDEXT,
    :CTAORDENANTE,
    :RFCEMISORCTABEN,
    :CTABENEFICIARIO,
    :TIPOCADPAGO,
    :CERTPAGO,
    :CADPAGO,
    :SELLOPAGO,
    :IDDOCUMENTO,
    :MONEDADR,
    :TIPOCAMBIODR,
    :METODODEPAGODR,
    :NUMPARCIALIDAD,
    :IMPSALDOANT,
    :IMPPAGADO,
    :IMPSALDOINSOLUTO,
    :TOTALTRASLADOS,
    :TOTALRETENCIONES,
    :TIPORELACION,
    :UUID,
    :IMPRIMIRCOMPROBANTESPAGO,
    :NUMEROPEDIMENTO,
    :MOVTOID,
    :MOVTOKITID,
    :PAGOSATID,
    :MOVTOREFID ,
    :EXPORTACION ,
    :OBJETOIMP ,
    :DOMICILIOFISCAL  ,
    :PERIODICIDAD ,
    :MESES ,
    :ANIO
    DO
    BEGIN
       SUSPEND;
    END



END
