CREATE OR ALTER TRIGGER MOVTOGASTO_BI2 FOR MOVTOGASTO
ACTIVE BEFORE INSERT POSITION 2
AS
    DECLARE VARIABLE ULTPARTIDA INTEGER;
BEGIN
    IF (NOT ((NEW.DOCTOID IS NULL) OR (NEW.DOCTOID = 0))) THEN
    BEGIN
        SELECT COALESCE(MAX(PARTIDA), 0)
        FROM MOVTO
        WHERE DOCTOID = NEW.DOCTOID
        INTO :ULTPARTIDA;

        NEW.PARTIDA = :ULTPARTIDA + 1;
    END
END