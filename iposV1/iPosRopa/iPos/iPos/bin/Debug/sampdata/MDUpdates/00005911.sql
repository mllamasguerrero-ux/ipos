create or alter procedure REPL_IMPO_COMPRASCAMBIOSUCURSAL (
    DOCTOACTUALID D_FK,
    REFERENCIA D_REFERENCIA,
    USERID D_FK,
    REFERENCIAS varchar(255),
    SUCURSALFUENTE D_CLAVE_NULL,
    TIPODOCTOID D_FK,
    FECHA D_FECHA,
    DESCRIPCION D_DESCRIPCION,
    OBSERVACION D_OBSERVACION,
    PERSONACLAVE D_CLAVE_NULL,
    NOTAPAGO D_STDTEXT_MEDIUM,
    FECHAFACTURA D_FECHA,
    ORIGENFISCALID D_FK)
returns (
    ERRORCODE D_ERRORCODE)
as
declare variable PROVEEDORID D_FK;
declare variable SUCURSALID D_FK;
declare variable SUCURSALTID D_FK;
declare variable PROVEEDORACTUALID D_FK;
BEGIN


   SELECT PARAMETRO.SUCURSALID FROM PARAMETRO INTO :SUCURSALID;

   SELECT SUCURSAL.ID FROM SUCURSAL WHERE CLAVE = :SUCURSALFUENTE INTO :SUCURSALTID;

   SELECT PERSONA.ID FROM PERSONA WHERE CLAVE = :PERSONACLAVE AND PERSONA.TIPOPERSONAID = 40 INTO :PROVEEDORID;

   SELECT PERSONAID FROM DOCTO WHERE ID = :DOCTOACTUALID  INTO :PROVEEDORACTUALID;

   IF(COALESCE(:PROVEEDORACTUALID,0) <> COALESCE(:PROVEEDORID, 0) AND COALESCE(:PROVEEDORID, 0) <> 0 ) THEN
   BEGIN        
          SELECT ERRORCODE FROM COMPRA_REASIGNAR_PROVEE (:DOCTOACTUALID, :PROVEEDORID , :USERID )
           INTO :ERRORCODE;
           
          IF (:ERRORCODE <> 0) THEN
          BEGIN

            SUSPEND;
            EXIT;
          END
   END



   -- provisional mientras cambio docto_insert y movto_insert.
   UPDATE DOCTO
   SET --REFERENCIAS = :REFERENCIAS, DESCRIPCION = :DESCRIPCION  , OBSERVACION = :OBSERVACION,
      NOTAPAGO = :NOTAPAGO  ,
    FECHAFACTURA = :FECHAFACTURA,
    ORIGENFISCALID = :ORIGENFISCALID ,
    REFERENCIA = :REFERENCIA
   WHERE ID = :DOCTOACTUALID;





   SUSPEND;
   EXIT;


END