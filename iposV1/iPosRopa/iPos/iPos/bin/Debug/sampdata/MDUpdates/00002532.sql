create or alter procedure CONTRARECIBOHEADER_CANCEL (
    CONTRARECIBOID type of D_FK,
    OBSERVACIONES D_STDTEXT_LARGE)
returns (
    ERRORCODE type of D_ERRORCODE)
as
declare variable ESTATUSID D_FK;
BEGIN


    
   IF ((:CONTRARECIBOID IS NULL) OR (:CONTRARECIBOID = 0)) THEN
   BEGIN
      ERRORCODE = 1002;
   END

    SELECT ESTATUSID FROM CONTRARECIBOHDR WHERE ID = :CONTRARECIBOID INTO :ESTATUSID;


    IF(COALESCE(:ESTATUSID,-1) <> 1) THEN
    BEGIN
              errorcode = 1002;
              SUSPEND;
              EXIT;

    END

    UPDATE DOCTO SET CONTRARECIBOID = 0 WHERE ID IN (SELECT ID FROM contrarecibodtl WHERE CONTRARECIBOID = :CONTRARECIBOID);

    
    UPDATE CONTRARECIBODTL SET ESTATUSID = 2 WHERE CONTRARECIBOID = :CONTRARECIBOID;

    UPDATE CONTRARECIBOHDR SET ESTATUSID = 2, OBSERVACIONES = :OBSERVACIONES WHERE ID = :CONTRARECIBOID;


   SUSPEND;
END