create or alter procedure VALIDAR_PARAFACTURAELECTRONICA (
    DOCTOID D_FK)
returns (
    RFC D_STDTEXT_MEDIUM,
    PERSONARFC D_STDTEXT_SHORT,
    STRINGERRORES varchar(254),
    VALIDEZ char(1))
as
declare variable PRODUCTODESCRIPCION D_DESCRIPCION;
declare variable NOMBRE D_STDTEXT_MEDIUM;
declare variable FISCALCALLE D_STDTEXT_MEDIUM;
declare variable FISCALNUMEROINTERIOR D_STDTEXT_SHORT;
declare variable FISCALNUMEROEXTERIOR D_STDTEXT_SHORT;
declare variable FISCALCOLONIA D_STDTEXT_MEDIUM;
declare variable FISCALMUNICIPIO D_STDTEXT_MEDIUM;
declare variable FISCALESTADO D_STDTEXT_SHORT;
declare variable FISCALCODIGOPOSTAL D_STDTEXT_SHORT;
declare variable CALLE D_STDTEXT_MEDIUM;
declare variable NUMEROINTERIOR D_STDTEXT_SHORT;
declare variable NUMEROEXTERIOR D_STDTEXT_SHORT;
declare variable COLONIA D_STDTEXT_MEDIUM;
declare variable LOCALIDAD D_STDTEXT_MEDIUM;
declare variable ESTADO D_STDTEXT_SHORT;
declare variable CP D_STDTEXT_SHORT;
declare variable PERSONANOMBRES D_STDTEXT_MEDIUM;
declare variable PERSONAAPELLIDOS D_STDTEXT_MEDIUM;
declare variable PERSONANUMEROINTERIOR D_STDTEXT_SHORT;
declare variable PERSONANUMEROEXTERIOR D_STDTEXT_SHORT;
declare variable PERSONACOLONIA D_STDTEXT_MEDIUM;
declare variable PERSONAMUNICIPIO D_STDTEXT_MEDIUM;
declare variable PERSONAESTADO D_STDTEXT_SHORT;
declare variable PERSONAPAIS D_STDTEXT_SHORT;
declare variable PERSONACODIGOPOSTAL D_STDTEXT_SHORT;
declare variable PERSONAID D_FK;
BEGIN

   VALIDEZ = 'S';
   PERSONAID = 0;

   FOR SELECT
      P.DESCRIPCION1,
      D.personaid
      FROM MOVTO M
      LEFT JOIN DOCTO D
         ON D.ID = M.DOCTOID
      LEFT JOIN PRODUCTO P
         ON P.ID = M.PRODUCTOID
   WHERE DOCTOID = :doctoid
   INTO
      :PRODUCTODESCRIPCION,
      :PERSONAID
   DO
   BEGIN
      IF(COALESCE(:PRODUCTODESCRIPCION,'') = '') THEN
      BEGIN
         STRINGERRORES  = 'HAY PRODUCTOS SIN DESCRIPCION';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
      END
   END


 SELECT
    FIRST 1
    NOMBRE ,
    RFC ,
    FISCALCALLE ,
    FISCALNUMEROINTERIOR ,
    FISCALNUMEROEXTERIOR ,
    FISCALCOLONIA  ,
    FISCALMUNICIPIO ,
    FISCALESTADO ,
    FISCALCODIGOPOSTAL  ,
    CALLE         ,
    NUMEROINTERIOR  ,
    NUMEROEXTERIOR  ,
    COLONIA      ,
    LOCALIDAD      ,
    ESTADO       ,
    CP
 FROM PARAMETRO
 INTO
    :NOMBRE ,
    :RFC ,
    :FISCALCALLE ,
    :FISCALNUMEROINTERIOR ,
    :FISCALNUMEROEXTERIOR ,
    :FISCALCOLONIA  ,
    :FISCALMUNICIPIO ,
    :FISCALESTADO ,
    :FISCALCODIGOPOSTAL  ,
    :CALLE         ,
    :NUMEROINTERIOR  ,
    :NUMEROEXTERIOR  ,
    :COLONIA      ,
    :LOCALIDAD      ,
    :ESTADO       ,
    :CP;



    select
        NOMBRES,
        APELLIDOS ,
        RFC ,
        NUMEROINTERIOR,
        NUMEROEXTERIOR,
        COLONIA,
        CIUDAD,
        ESTADO,
        PAIS,
        CODIGOPOSTAL
     FROM PERSONA
     WHERE ID = :PERSONAID
     INTO
        :PERSONANOMBRES,
        :PERSONAAPELLIDOS,
        :PERSONARFC ,
        :PERSONANUMEROINTERIOR,
        :PERSONANUMEROEXTERIOR,
        :PERSONACOLONIA,
        :PERSONAMUNICIPIO,
        :PERSONAESTADO,
        :PERSONAPAIS,
        :PERSONACODIGOPOSTAL;


    IF(COALESCE(:NOMBRE , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL NOMBRE DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
    IF(COALESCE(:RFC , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL RFC DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
    IF(COALESCE(:FISCALCALLE , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL DOMICILIO DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
    IF(COALESCE(:FISCALNUMEROINTERIOR , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL NUMERO INTERIOR DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'W';

    END
    IF(COALESCE(:FISCALNUMEROEXTERIOR , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL NUMERO EXTERIOR DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
    IF(COALESCE(:FISCALCOLONIA  , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CAMPO COLONIA DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
    IF(COALESCE(:FISCALMUNICIPIO , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CAMPO MUNICIPIO DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
    IF(COALESCE(:FISCALESTADO , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CAMPO ESTADO DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
    IF(COALESCE(:FISCALCODIGOPOSTAL  , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CODIGO POSTAL DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
    IF(COALESCE(:CALLE         ,  '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL DOMICILIO DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
    IF(COALESCE(:NUMEROINTERIOR  , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL NUMERO INTERIOR DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'W';
    END
    IF(COALESCE(:NUMEROEXTERIOR  , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL NUMERO EXTERIOR DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
    IF(COALESCE(:COLONIA      ,  '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CAMPO COLONIA DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
    IF(COALESCE(:LOCALIDAD      , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CAMPO LOCALIDAD DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
    IF(COALESCE(:ESTADO       , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CAMPO ESTADO DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
    IF(COALESCE(:CP , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CODIGO POSTAL DE LA EMPRESA ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END

     IF(COALESCE(:PERSONANOMBRES,  '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CAMPO NOMBRES DEL CLIENTE O PROVEEDOR ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
     IF(COALESCE(:PERSONAAPELLIDOS , '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CAMPO APELLIDOS DEL CLIENTE O PROVEEDOR ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
     IF(COALESCE(:PERSONARFC ,  '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL RFC DEL CLIENTE O PROVEEDOR ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
     IF(COALESCE(:PERSONANUMEROINTERIOR,  '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL NUMERO INTERIOR DEL CLIENTE O PROVEEDOR ESTA VACIO';
         VALIDEZ = 'W';
    END
     IF(COALESCE(:PERSONANUMEROEXTERIOR,   '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL NUMERO EXTERIOR DEL CLIENTE O PROVEEDOR ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
     IF(COALESCE(:PERSONACOLONIA,  '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CAMPO COLONIA DEL CLIENTE O PROVEEDOR ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
     IF(COALESCE(:PERSONAMUNICIPIO,  '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CAMPO CIUDAD DEL CLIENTE O PROVEEDOR ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
     IF(COALESCE(:PERSONAESTADO,  '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CAMPO ESTADO DEL CLIENTE O PROVEEDOR ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
     IF(COALESCE(:PERSONAPAIS,    '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CAMPO PAIS DEL CLIENTE O PROVEEDOR ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END
     IF(COALESCE(:PERSONACODIGOPOSTAL,  '') = '' ) THEN
    BEGIN
         STRINGERRORES  = 'EL CAMPO CODIGO POSTAL ESTA VACIO';
         VALIDEZ = 'N';
         SUSPEND;
         EXIT;
    END


       SUSPEND;
       
   WHEN ANY DO
   BEGIN
      STRINGERRORES  = 'HUBO UN ERROR AL MANDAR LLAMAR AL PROCEDIMIENTO DE VALIDEZ';
      VALIDEZ = 'N';
      SUSPEND;
   END 


END