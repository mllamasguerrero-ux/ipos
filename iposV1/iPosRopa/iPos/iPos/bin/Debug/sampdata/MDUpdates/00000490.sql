CREATE OR ALTER TRIGGER PRODUCTO_AU30 FOR PRODUCTO
ACTIVE AFTER UPDATE POSITION 30
AS
declare variable CUENTA  INTEGER ;
BEGIN
  IF (NEW.PRODUCTOPADRE <> OLD.PRODUCTOPADRE) THEN
  BEGIN
       UPDATE PRODUCTO SET ESPRODUCTOPADRE = 'S' , ESPRODUCTOFINAL = 'N'
       WHERE ID =  NEW.PRODUCTOPADRE AND  ESPRODUCTOPADRE = 'N';

       IF(OLD.PRODUCTOPADRE IS NOT NULL) THEN
       BEGIN
               SELECT COUNT(*) FROM PRODUCTO WHERE PRODUCTOPADRE = OLD.PRODUCTOPADRE INTO :CUENTA;
               IF(COALESCE(:CUENTA,0) <= 0) THEN
               BEGIN
                   UPDATE PRODUCTO SET ESPRODUCTOPADRE = 'N' , ESPRODUCTOFINAL = 'S'
                   WHERE ID =  OLD.PRODUCTOPADRE AND  ESPRODUCTOPADRE = 'S';
               END
       END
   END


   IF(NEW.DESCRIPCION <> OLD.DESCRIPCION or NEW.DESCRIPCION1 <> OLD.DESCRIPCION1
       or NEW.INVENTARIABLE <> OLD.INVENTARIABLE   ) THEN
   BEGIN
       UPDATE PRODUCTO SET DESCRIPCION = NEW.DESCRIPCION , DESCRIPCION1 = NEW.DESCRIPCION1  ,
       INVENTARIABLE = NEW.INVENTARIABLE
       WHERE PRODUCTOPADRE = NEW.ID;
   END

   
   IF(NEW.PRECIO1 <> OLD.PRECIO1 or
      NEW.PRECIO2 <> OLD.PRECIO2 or
      NEW.PRECIO3 <> OLD.PRECIO3 or
      NEW.PRECIO4 <> OLD.PRECIO4 or
      NEW.PRECIO5 <> OLD.PRECIO5  or
      NEW.LIMITEPRECIO2 <> OLD.LIMITEPRECIO2 or
      NEW.PRECIOMAXIMOPUBLICO <> OLD.PRECIOMAXIMOPUBLICO  ) THEN
   BEGIN
       UPDATE PRODUCTO SET
       PRECIO1 = NEW.PRECIO1,
       PRECIO2 = NEW.PRECIO2,
       PRECIO3 = NEW.PRECIO3,
       PRECIO4 = NEW.PRECIO4,
       PRECIO5 = NEW.PRECIO5 ,
       LIMITEPRECIO2 = NEW.LIMITEPRECIO2 ,
       PRECIOMAXIMOPUBLICO = NEW.PRECIOMAXIMOPUBLICO
       WHERE PRODUCTOPADRE = NEW.ID AND TOMARPRECIOPADRE = 'S';
   END

   IF(NEW.COMISION <> OLD.COMISION ) THEN
   BEGIN
       UPDATE PRODUCTO SET
       COMISION = NEW.COMISION
       WHERE PRODUCTOPADRE = NEW.ID AND TOMARCOMISIONPADRE = 'S';
   END

   
   IF(NEW.OFERTA <> OLD.OFERTA ) THEN
   BEGIN
       UPDATE PRODUCTO SET
       OFERTA = NEW.OFERTA
       WHERE PRODUCTOPADRE = NEW.ID AND TOMAROFERTAPADRE = 'S';
   END

   
   IF(NEW.PZACAJA <> OLD.PZACAJA OR
      NEW.U_EMPAQUE <> OLD.u_empaque OR
      NEW.unidad <> OLD.UNIDAD ) THEN
   BEGIN
       UPDATE PRODUCTO SET
       PZACAJA = NEW.PZACAJA,
       U_EMPAQUE = new.u_empaque, 
       unidad = new.unidad
       WHERE PRODUCTOPADRE = NEW.ID ;
   END




END