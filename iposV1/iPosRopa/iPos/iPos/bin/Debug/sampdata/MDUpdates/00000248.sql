CREATE OR ALTER PROCEDURE DOCTO_PAGOS (
   DOCTOID D_FK,
   FECHA D_FECHA,
   FECHAHORA D_TIMESTAMP,
   CORTEID D_FK,
   IMPORTETOTALAPAGAR D_IMPORTE,
   IMPORTEEFECTIVO D_IMPORTE,
   IMPORTETARJETA D_IMPORTE,
   IMPORTECHEQUE D_IMPORTE,
   IMPORTECREDITO D_IMPORTE,
   IMPORTEEFECTIVORECIBIDO D_IMPORTE)
RETURNS (
   ERRORCODE D_ERRORCODE)
AS
DECLARE VARIABLE FORMAPAGOID D_FK;
DECLARE VARIABLE IMPORTECAMBIO D_IMPORTE;
DECLARE VARIABLE IMPORTEEFECTIVONETO D_IMPORTE;
BEGIN
   IMPORTEEFECTIVO = COALESCE(:IMPORTEEFECTIVO, 0.0000);
   IMPORTETARJETA = COALESCE(:IMPORTETARJETA, 0.0000);
   IMPORTECHEQUE = COALESCE(:IMPORTECHEQUE, 0.0000);
   IMPORTECREDITO = COALESCE(:IMPORTECREDITO, 0.0000);
  
   IMPORTEEFECTIVONETO = :IMPORTETOTALAPAGAR - :IMPORTETARJETA - :IMPORTECHEQUE - :IMPORTECREDITO;

   IMPORTECAMBIO = :IMPORTEEFECTIVORECIBIDO - :IMPORTEEFECTIVONETO;
  
   IF (:IMPORTEEFECTIVONETO > 0.00) THEN
   BEGIN
      FORMAPAGOID = 1; -- Efectivo
      SELECT ERRORCODE
      FROM DOCTOPAGO_INSERT (
         :DOCTOID,
         :FORMAPAGOID,
         :FECHA, :FECHAHORA, :CORTEID,
         :IMPORTEEFECTIVONETO,
         :IMPORTEEFECTIVORECIBIDO,
         :IMPORTECAMBIO
      ) INTO :ERRORCODE;
   END

   IF (:IMPORTETARJETA > 0.00) THEN
   BEGIN
      FORMAPAGOID = 2; -- Tarjeta
      SELECT ERRORCODE
      FROM DOCTOPAGO_INSERT (
         :DOCTOID,
         :FORMAPAGOID,
         :FECHA, :FECHAHORA, :CORTEID,
         :IMPORTETARJETA, 0.00, 0.00
      ) INTO :ERRORCODE;
   END

   IF (:IMPORTECHEQUE > 0.00) THEN
   BEGIN
      FORMAPAGOID = 3; -- Cheque
      SELECT ERRORCODE
      FROM DOCTOPAGO_INSERT (
         :DOCTOID,
         :FORMAPAGOID,
         :FECHA, :FECHAHORA, :CORTEID,
         :IMPORTECHEQUE, 0.00, 0.00
      ) INTO :ERRORCODE;
   END

   IF (:IMPORTECREDITO > 0.00) THEN
   BEGIN
      FORMAPAGOID = 4; -- Credito
      SELECT ERRORCODE
      FROM DOCTOPAGO_INSERT (
         :DOCTOID,
         :FORMAPAGOID,
         :FECHA, :FECHAHORA, :CORTEID,
         :IMPORTECREDITO, 0.00, 0.00
      ) INTO :ERRORCODE;
   END

   ERRORCODE = 0;
   SUSPEND;

   WHEN ANY DO
   BEGIN
      ERRORCODE = 1016;
      SUSPEND;
   END
END;